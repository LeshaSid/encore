Project Path: encore

Source Tree:

```txt
encore
├── Dockerfile
├── README.md
├── booking
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── forms.py
│   ├── migrations
│   │   ├── 0001_initial.py
│   │   └── __init__.py
│   ├── models.py
│   ├── templates
│   │   └── booking
│   │       └── bookPage.html
│   ├── tests.py
│   ├── urls.py
│   └── views.py
├── concertsshower
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── models.py
│   ├── templates
│   │   └── concertsshower
│   │       ├── all_concerts.html
│   │       ├── base.html
│   │       ├── concert_detail.html
│   │       ├── concert_not_found.html
│   │       ├── pagination.html
│   │       └── upcoming_concerts.html
│   ├── templatetags
│   │   ├── __init__.py
│   │   └── concert_filters.py
│   ├── tests.py
│   ├── urls.py
│   └── views.py
├── config
│   ├── __init__.py
│   ├── asgi.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── core
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── forms.py
│   ├── migrations
│   │   ├── 0001_initial.py
│   │   ├── 0002_band_logo.py
│   │   └── __init__.py
│   └── models.py
├── custom_admin
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── forms.py
│   ├── migrations
│   │   └── __init__.py
│   ├── models.py
│   ├── templates
│   │   └── custom_admin
│   │       ├── bands
│   │       │   ├── confirm_delete.html
│   │       │   ├── form.html
│   │       │   └── list.html
│   │       ├── base.html
│   │       ├── concerts
│   │       │   ├── confirm_delete.html
│   │       │   ├── form.html
│   │       │   └── list.html
│   │       ├── dashboard.html
│   │       ├── membership
│   │       │   ├── confirm_delete.html
│   │       │   ├── form.html
│   │       │   └── list.html
│   │       ├── musicians
│   │       │   ├── confirm_delete.html
│   │       │   ├── form.html
│   │       │   └── list.html
│   │       ├── performances
│   │       │   ├── confirm_delete.html
│   │       │   ├── form.html
│   │       │   └── list.html
│   │       └── rehearsals
│   │           ├── confirm_delete.html
│   │           ├── form.html
│   │           └── list.html
│   ├── tests.py
│   ├── urls.py
│   └── views.py
├── docker-compose.yml
├── for_authorization
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── forms.py
│   ├── migrations
│   │   ├── 0001_initial.py
│   │   └── __init__.py
│   ├── models.py
│   ├── templates
│   │   └── core
│   │       ├── home.html
│   │       ├── profile
│   │       │   ├── password_change.html
│   │       │   ├── profile.html
│   │       │   └── profile_edit.html
│   │       └── registration
│   │           ├── login.html
│   │           ├── password_reset.html
│   │           ├── password_reset_complete.html
│   │           ├── password_reset_confirm.html
│   │           ├── password_reset_done.html
│   │           └── register.html
│   ├── tests.py
│   ├── urls.py
│   └── views.py
├── groups
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── forms.py
│   ├── models.py
│   ├── templates
│   │   └── groups
│   │       ├── band_confirm_delete.html
│   │       ├── band_confirm_remove.html
│   │       ├── band_form.html
│   │       ├── band_list.html
│   │       ├── band_members.html
│   │       └── member_confirm_remove.html
│   ├── tests.py
│   ├── urls.py
│   └── views.py
├── manage.py
├── media
│   └── band_logos
│       ├── images.webp
│       └── photo_2022-03-24_00-05-33.jpg
├── requirements.txt
└── templates
    └── base.html

```

`Dockerfile`:

```
FROM python:3.11-slim

WORKDIR /app

ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

RUN apt-get update \
    && apt-get install -y gcc libpq-dev \
    && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --upgrade pip \
    && pip install -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]

```

`README.md`:

```md
# Encore — Управление музыкальными событиями

**Encore** — это веб-платформа для автоматизации работы музыкальных коллективов. Проект позволяет бронировать репетиции, отслеживать график концертов и управлять составом групп.

---

## Реализованные функции

* **Система бронирования:** Онлайн-запись на репетиции с выбором группы, времени и места.
* **Концертная афиша:** Разделение на предстоящие и прошедшие мероприятия с детальной информацией о каждом событии.
* **Управление контентом:** Административная панель для модерации групп, музыкантов и расписания.
* **Личный кабинет:** Регистрация, авторизация и возможность редактирования профиля пользователя.
* **Программки концертов:** Отображение списка выступающих групп для каждого конкретного мероприятия.

---

## Инструкция по установке и запуску (Docker)

Проект полностью контейнеризирован для быстрого развертывания.

### 1. Требования
* Установленный **Docker** и **Docker Compose**.

### 2. Клонирование и запуск
Перейдите в директорию проекта и выполните сборку:

```bash
# Сборка и запуск контейнеров в фоновом режиме
docker-compose up -d --build
```

`booking/admin.py`:

```py
from django.contrib import admin

```

`booking/apps.py`:

```py
from django.apps import AppConfig


class BookingConfig(AppConfig):
    name = 'booking'

```

`booking/forms.py`:

```py
from core.models import Rehearsal, Band
from django.forms import ModelForm, TextInput, DateTimeInput, NumberInput, Select


class RehearsalsForm(ModelForm):
    class Meta():
        model = Rehearsal
        fields = ["band", "rehearsal_date", "duration_minutes", "location"]

        widgets = {            
            "band": Select(attrs={
                "class": "form-control",
                "placeholder": "Выберите группу"
            }), 
            "rehearsal_date": DateTimeInput(attrs={
                "class": "form-control",
                "placeholder": "Выберите дату и время",
                "type": "datetime-local"
            }),
            "duration_minutes": NumberInput(attrs={
                "class": "form-control",
                "placeholder": "Введите длительность в минутах"
            }),
            "location": TextInput(attrs={
                "class": "form-control",
                "placeholder": "Введите место проведения"
            })
        }
    
    def __init__(self, *args, **kwargs):
        super(RehearsalsForm, self).__init__(*args, **kwargs)
        # Заменяем поле выбора группы на queryset с названиями групп
        self.fields['band'].queryset = Band.objects.all()
        self.fields['band'].label_from_instance = lambda obj: obj.band_name
```

`booking/migrations/0001_initial.py`:

```py
# Generated by Django 5.2.9 on 2025-12-16 20:28

from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='Band_membership',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('band_id', models.IntegerField(verbose_name='Band id')),
                ('musician_id', models.IntegerField(verbose_name='Musician id')),
                ('join_date', models.DateTimeField(verbose_name='Joined')),
            ],
            options={
                'db_table': 'band_membership',
                'managed': False,
            },
        ),
        migrations.CreateModel(
            name='Bands',
            fields=[
                ('band_id', models.AutoField(db_column='band_id', primary_key=True, serialize=False)),
                ('band_name', models.CharField(max_length=100, verbose_name='Band name')),
                ('genre', models.CharField(max_length=50, verbose_name='Genre')),
                ('founded_date', models.DateTimeField(verbose_name='Founded')),
            ],
            options={
                'db_table': 'bands',
                'managed': False,
            },
        ),
        migrations.CreateModel(
            name='Concerts',
            fields=[
                ('concert_id', models.AutoField(db_column='concert_id', primary_key=True, serialize=False)),
                ('concert_title', models.CharField(max_length=200, verbose_name='Title')),
                ('venue_address', models.CharField(max_length=255, verbose_name='Address')),
                ('concert_date', models.DateTimeField(verbose_name='Date')),
            ],
            options={
                'db_table': 'concerts',
                'managed': False,
            },
        ),
        migrations.CreateModel(
            name='Musicians',
            fields=[
                ('musician_id', models.AutoField(db_column='musician_id', primary_key=True, serialize=False)),
                ('first_name', models.CharField(max_length=50, verbose_name='First name')),
                ('last_name', models.CharField(max_length=50, verbose_name='Last name')),
                ('phone', models.CharField(max_length=20, verbose_name='Phone')),
                ('telegram', models.CharField(max_length=100, verbose_name='Telegram')),
                ('instrument', models.CharField(max_length=100, verbose_name='Instrument')),
            ],
            options={
                'db_table': 'musicians',
                'managed': False,
            },
        ),
        migrations.CreateModel(
            name='Performances',
            fields=[
                ('performance_id', models.AutoField(db_column='performance_id', primary_key=True, serialize=False)),
                ('band_id', models.IntegerField(verbose_name='Band id')),
                ('concert_id', models.IntegerField(verbose_name='Concert id')),
                ('performance_order', models.IntegerField(verbose_name='Performance order')),
            ],
            options={
                'db_table': 'performances',
                'managed': False,
            },
        ),
        migrations.CreateModel(
            name='Rehearsals',
            fields=[
                ('rehearsal_id', models.AutoField(db_column='rehearsal_id', primary_key=True, serialize=False)),
                ('band_id', models.IntegerField(verbose_name='band id')),
                ('rehearsal_date', models.DateTimeField(verbose_name='Date & time')),
                ('duration_minutes', models.IntegerField(verbose_name='Duration minutes')),
                ('location', models.CharField(max_length=255, verbose_name='Location')),
            ],
            options={
                'db_table': 'rehearsals',
                'managed': False,
            },
        ),
    ]

```

`booking/models.py`:

```py
from django.db import models


class Rehearsals(models.Model):
    rehearsal_id = models.AutoField(primary_key=True, db_column='rehearsal_id')
    band_id = models.IntegerField("band id")
    rehearsal_date = models.DateTimeField("Date & time")
    duration_minutes = models.IntegerField("Duration minutes")
    location = models.CharField("Location", max_length=255)

    class Meta():
        db_table = "rehearsals"
        managed = False

    def __str__(self):
        return f"Rehearsal {self.rehearsal_id} on {self.rehearsal_date}"
    

class Bands(models.Model):
    band_id = models.AutoField(primary_key=True, db_column='band_id')
    band_name = models.CharField("Band name", max_length=100)
    genre = models.CharField("Genre", max_length=50)
    founded_date = models.DateTimeField("Founded")

    class Meta():
        db_table = "bands"
        managed = False

    def __str__(self):
        return self.band_name
    

class Band_membership(models.Model):
    id = models.BigAutoField(primary_key=True)
    band_id = models.IntegerField("Band id")
    musician_id = models.IntegerField("Musician id")
    join_date = models.DateTimeField("Joined")

    class Meta():
        db_table = "band_membership"
        managed = False

    def __str__(self):
        return f"Membership {self.id}"
    

class Musicians(models.Model):
    musician_id = models.AutoField(primary_key=True, db_column='musician_id')
    first_name = models.CharField("First name", max_length=50)
    last_name = models.CharField("Last name", max_length=50)
    phone = models.CharField("Phone", max_length=20)
    telegram = models.CharField("Telegram", max_length=100)
    instrument = models.CharField("Instrument", max_length=100)

    class Meta():
        db_table = "musicians"
        managed = False

    def __str__(self):
        return f"{self.first_name} {self.last_name}"


class Performances(models.Model):
    performance_id = models.AutoField(primary_key=True, db_column='performance_id')
    band_id = models.IntegerField("Band id")
    concert_id = models.IntegerField("Concert id")
    performance_order = models.IntegerField("Performance order")

    class Meta():
        db_table = "performances"
        managed = False

    def __str__(self):
        return f"Performance {self.performance_id}"
    

class Concerts(models.Model):
    concert_id = models.AutoField(primary_key=True, db_column='concert_id')
    concert_title = models.CharField("Title", max_length=200)
    venue_address = models.CharField("Address", max_length=255)
    concert_date = models.DateTimeField("Date")

    class Meta():
        db_table = "concerts"
        managed = False

    def __str__(self):
        return self.concert_title
```

`booking/templates/booking/bookPage.html`:

```html
{% extends "base.html" %}

{% block title %}
Бронь репетиции - Encore
{% endblock %}

{% block content %}
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-5 fw-bold text-primary">
                <i class="bi bi-calendar-plus"></i> Бронирование репетиций
            </h1>
            <p class="lead">Забронируйте репетицию для вашей музыкальной группы</p>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-6">
            <div class="card border-primary shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-plus-circle"></i> Новая репетиция
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" action="">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="id_band" class="form-label fw-bold">
                                <i class="bi bi-people"></i> Название группы
                            </label>
                            {{ form.band }}
                            <div class="form-text">Выберите вашу музыкальную группу из списка</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="id_rehearsal_date" class="form-label fw-bold">
                                <i class="bi bi-clock"></i> Дата и время
                            </label>
                            {{ form.rehearsal_date }}
                        </div>
                        
                        <div class="mb-3">
                            <label for="id_duration_minutes" class="form-label fw-bold">
                                <i class="bi bi-stopwatch"></i> Длительность (минуты)
                            </label>
                            {{ form.duration_minutes }}
                        </div>
                        
                        <div class="mb-3">
                            <label for="id_location" class="form-label fw-bold">
                                <i class="bi bi-geo-alt"></i> Место проведения
                            </label>
                            {{ form.location }}
                            <div class="form-text">Адрес или название помещения</div>
                        </div>
                        
                        {% if error %}
                            <div class="alert alert-danger alert-dismissible fade show">
                                <i class="bi bi-exclamation-triangle"></i>
                                {{ error }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endif %}
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-check-circle"></i> Забронировать
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mt-4 mt-lg-0">
            <div class="card border-success shadow">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-list-check"></i> Забронированные репетиции
                        <span class="badge bg-light text-dark ms-2">{{ rehearsals|length }}</span>
                    </h5>
                </div>
                <div class="card-body">
                    {% if rehearsals %}
                        <div class="table-responsive">
                            <table class="table table-hover table-striped">
                                <thead class="table-light">
                                    <tr>
                                        <th>ID</th>
                                        <th>Группа</th>
                                        <th>Дата и время</th>
                                        <th>Длительность</th>
                                        <th>Место</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for rehearsal in rehearsals %}
                                        <tr>
                                            <td><span class="badge bg-secondary">{{ rehearsal.rehearsal_id }}</span></td>
                                            <td><span class="badge bg-info">{{ rehearsal.band.band_id }}</span></td>
                                            <td>{{ rehearsal.rehearsal_date|date:"d.m.Y H:i" }}</td>
                                            <td>
                                                <span class="badge bg-warning text-dark">
                                                    {{ rehearsal.duration_minutes }} мин.
                                                </span>
                                            </td>
                                            <td><small>{{ rehearsal.location|truncatechars:20 }}</small></td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="bi bi-calendar-x display-1 text-muted"></i>
                            <h4 class="text-muted mt-3">Нет забронированных репетиций</h4>
                            <p class="text-muted">Начните с бронирования первой репетиции</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
```

`booking/tests.py`:

```py
from django.test import TestCase, Client
from django.urls import reverse
from core.models import Band, Rehearsal
from django.utils import timezone

class BookingViewTests(TestCase):
    def setUp(self):
        self.client = Client()
        self.band = Band.objects.create(
            band_name="Test Band",
            genre="rock",
            founded_date=timezone.now().date()
        )
        self.url = reverse('book')

    def test_book_page_status_code(self):
        response = self.client.get(self.url)
        self.assertEqual(response.status_code, 200)

    def test_rehearsal_creation(self):
        data = {
            'band': self.band.band_id,
            'rehearsal_date': '2025-12-25T14:00',
            'duration_minutes': 60,
            'location': 'Main Studio'
        }
        response = self.client.post(self.url, data)
        self.assertEqual(response.status_code, 302)
        self.assertTrue(Rehearsal.objects.filter(location='Main Studio').exists())
```

`booking/urls.py`:

```py
from django.urls import path
from . import views

urlpatterns = [
    path('', views.book, name='book'),
]
```

`booking/views.py`:

```py
from django.shortcuts import render, redirect
from django.contrib import messages
from django.db import connection
from core.models import Rehearsal, Band
from .forms import RehearsalsForm


def book(request):
    error = ""

    try:
        with connection.cursor() as cursor:
            cursor.execute("SELECT column_name FROM information_schema.columns WHERE table_name = 'rehearsals'")
            columns = [row[0] for row in cursor.fetchall()]
            print("Columns in rehearsals table:", columns)
    except Exception as e:
        print(f"Error checking table structure: {e}")
    
    if request.method == "POST":
        form = RehearsalsForm(request.POST)
        if form.is_valid():
            try:
                new_rehearsal = form.save()
                messages.success(request, "Репетиция успешно забронирована!")
                return redirect('book')
            except Exception as e:
                error = f"Ошибка сохранения: {str(e)}"
                messages.error(request, error)
        else:
            error = "Форма заполнена некорректно"
            messages.error(request, error)
    else:
        form = RehearsalsForm()

    try:
        rehearsals = Rehearsal.objects.select_related('band').all()
    except Exception as e:
        rehearsals = []
        error = f"Ошибка загрузки данных: {str(e)}"
        messages.error(request, error)

    data = {
        "form": form,
        "error": error,
        "rehearsals": rehearsals
    }

    return render(request, "booking/bookPage.html", data)
```

`concertsshower/admin.py`:

```py
from django.contrib import admin
```

`concertsshower/apps.py`:

```py
from django.apps import AppConfig

class ConcertsshowerConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'concertsshower'
```

`concertsshower/models.py`:

```py
from django.db import models

class Band(models.Model):
    band_id = models.AutoField(primary_key=True, db_column='band_id')
    band_name = models.CharField("Название группы", max_length=100)
    genre = models.CharField("Жанр", max_length=50)
    founded_date = models.DateTimeField("Дата основания")

    class Meta:
        db_table = "bands"
        managed = False

    def __str__(self):
        return self.band_name

class Concert(models.Model):
    concert_id = models.AutoField(primary_key=True, db_column='concert_id')
    concert_title = models.CharField("Название", max_length=200)
    venue_address = models.CharField("Адрес", max_length=255)
    concert_date = models.DateTimeField("Дата и время")

    class Meta:
        db_table = "concerts"
        managed = False

    def __str__(self):
        return self.concert_title

class Performance(models.Model):
    performance_id = models.AutoField(primary_key=True, db_column='performance_id')
    band = models.ForeignKey(Band, on_delete=models.DO_NOTHING, db_column='band_id')
    concert = models.ForeignKey(Concert, on_delete=models.DO_NOTHING, db_column='concert_id', related_name='performances')
    performance_order = models.IntegerField("Порядок выступления")

    class Meta:
        db_table = "performances"
        managed = False

    def __str__(self):
        return f"Выступление {self.performance_id} на {self.concert.concert_title}"
```

`concertsshower/templates/concertsshower/all_concerts.html`:

```html
{% extends 'concertsshower/base.html' %}
{% load concert_filters %}

{% block title %}Все концерты - Encore{% endblock %}
{% block page_title %}Все концерты{% endblock %}
{% block page_subtitle %}Полный архив музыкальных выступлений{% endblock %}

{% block concerts_content %}
<div class="card mb-4 shadow-sm">
    <div class="card-body">
        <h5 class="card-title mb-3">
            <i class="bi bi-funnel"></i> Поиск и фильтрация
        </h5>
        <form method="get" class="row g-3">
            <div class="col-md-4">
                <label for="search" class="form-label">По названию</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" id="search" name="search" 
                           placeholder="Введите название концерта" value="{{ search_query }}">
                </div>
            </div>
            <div class="col-md-3">
                <label for="from_date" class="form-label">С даты</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-calendar"></i></span>
                    <input type="date" class="form-control" id="from_date" name="from_date" 
                           value="{{ from_date }}">
                </div>
            </div>
            <div class="col-md-3">
                <label for="to_date" class="form-label">По дату</label>
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-calendar"></i></span>
                    <input type="date" class="form-control" id="to_date" name="to_date" 
                           value="{{ to_date }}">
                </div>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <div class="d-grid gap-2 w-100">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-filter"></i> Применить
                    </button>
                </div>
            </div>
            <div class="col-12">
                {% if search_query or from_date or to_date %}
                <a href="{% url 'concertsshower:all_concerts' %}" class="btn btn-outline-secondary btn-sm">
                    <i class="bi bi-x-circle"></i> Сбросить фильтры
                </a>
                <span class="ms-3 text-muted small">
                    <i class="bi bi-info-circle"></i> Применены фильтры
                </span>
                {% endif %}
            </div>
        </form>
    </div>
</div>

{% if concerts %}
    <div class="row mb-3">
        <div class="col">
            <div class="alert alert-light">
                <i class="bi bi-info-circle"></i>
                Найдено: <strong>{{ concerts.paginator.count }}</strong> концертов
                {% if concerts.paginator.num_pages > 1 %}
                (показано {{ concerts.start_index }}-{{ concerts.end_index }})
                {% endif %}
            </div>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for concert in concerts %}
        <div class="col">
            <div class="card concert-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title mb-0">
                            <a href="{% url 'concertsshower:concert_detail' concert.concert_id %}" 
                               class="text-decoration-none text-dark">
                                {{ concert.concert_title }}
                            </a>
                        </h5>
                        <span class="badge {% if concert.concert_date > now %}bg-success{% else %}bg-secondary{% endif %}">
                            {% if concert.concert_date > now %}Предстоящий{% else %}Прошедший{% endif %}
                        </span>
                    </div>
                    
                    <div class="concert-date mb-3">
                        <i class="bi bi-calendar-event text-primary"></i>
                        <strong>{{ concert.concert_date|date:"d.m.Y" }}</strong>
                        <i class="bi bi-clock text-primary ms-2"></i>
                        {{ concert.concert_date|time:"H:i" }}
                    </div>
                    
                    <div class="concert-venue mb-3">
                        <i class="bi bi-geo-alt text-secondary"></i>
                        <span class="text-muted">{{ concert.venue_address }}</span>
                    </div>
                    
                    <div class="concert-status mt-3 pt-3 border-top">
                        <div class="row">
                            <div class="col">
                                <small class="text-muted">
                                    <i class="bi bi-clock-history"></i>
                                    {% if concert.concert_date > now %}
                                        Через {{ concert.concert_date|timeuntil }}
                                    {% else %}
                                        {{ concert.concert_date|timesince }} назад
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-top-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="{% url 'concertsshower:concert_detail' concert.concert_id %}" 
                           class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-eye"></i> Подробнее
                        </a>
                        {% if concert.concert_date > now %}
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-ticket-perforated"></i> Билеты
                        </span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% include 'concertsshower/pagination.html' with page_obj=concerts %}
    
{% else %}
    <div class="text-center py-5">
        <i class="bi bi-calendar-x display-1 text-muted"></i>
        <h3 class="text-muted mt-3">Концерты не найдены</h3>
        <p class="text-muted">
            {% if search_query or from_date or to_date %}
                По вашему запросу ничего не найдено. Попробуйте изменить параметры поиска.
            {% else %}
                В системе пока нет концертов.
            {% endif %}
        </p>
        {% if search_query or from_date or to_date %}
        <a href="{% url 'concertsshower:all_concerts' %}" class="btn btn-primary mt-2">
            <i class="bi bi-arrow-counterclockwise"></i> Показать все концерты
        </a>
        {% endif %}
    </div>
{% endif %}

<div class="mt-5 pt-4 border-top">
    <div class="d-flex justify-content-between">
        <a href="{% url 'concertsshower:upcoming_concerts' %}" class="btn btn-outline-primary">
            <i class="bi bi-calendar-event"></i> Ближайшие концерты
        </a>
        <a href="{% url 'book' %}" class="btn btn-outline-success">
            <i class="bi bi-calendar-plus"></i> Бронирование репетиций
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const fromDateInput = document.getElementById('from_date');
        const toDateInput = document.getElementById('to_date');
        
        if (fromDateInput && toDateInput) {
            fromDateInput.addEventListener('change', function() {
                if (this.value) {
                    toDateInput.min = this.value;
                }
            });
            
            toDateInput.addEventListener('change', function() {
                if (this.value) {
                    fromDateInput.max = this.value;
                }
            });
        }
    });
</script>
{% endblock %}
```

`concertsshower/templates/concertsshower/base.html`:

```html
{% extends "base.html" %}

{% block content %}
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-5 fw-bold text-primary">
                <i class="bi bi-music-note-list"></i> {% block page_title %}{% endblock %}
            </h1>
            <p class="lead">{% block page_subtitle %}{% endblock %}</p>
        </div>
    </div>
    
    {% block concerts_content %}{% endblock %}
{% endblock %}
```

`concertsshower/templates/concertsshower/concert_detail.html`:

```html
{% extends 'concertsshower/base.html' %}

{% block title %}{{ concert.concert_title }} - Encore{% endblock %}
{% block page_title %}{{ concert.concert_title }}{% endblock %}
{% block page_subtitle %}Детальная информация о концерте{% endblock %}

{% block concerts_content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-3">
                            <div class="me-3">
                                <i class="bi bi-calendar-event display-6 text-primary"></i>
                            </div>
                            <div>
                                <h5 class="mb-1">Дата и время</h5>
                                <p class="fs-5 mb-0">
                                    <strong>{{ concert.concert_date|date:"d.m.Y" }}</strong>
                                    <br>
                                    <span class="text-muted">{{ concert.concert_date|time:"H:i" }}</span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center mb-3">
                            <div class="me-3">
                                <i class="bi bi-geo-alt display-6 text-success"></i>
                            </div>
                            <div>
                                <h5 class="mb-1">Место проведения</h5>
                                <p class="fs-6 mb-0">
                                    {{ concert.venue_address }}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-12">
                        <div class="alert {% if concert.concert_date > now %}alert-success{% else %}alert-secondary{% endif %}">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="bi {% if concert.concert_date > now %}bi-clock{% else %}bi-check-circle{% endif %}"></i>
                                    <strong>
                                        {% if concert.concert_date > now %}
                                            Концерт состоится через {{ concert.concert_date|timeuntil }}
                                        {% else %}
                                            Концерт прошел {{ concert.concert_date|timesince }} назад
                                        {% endif %}
                                    </strong>
                                </div>
                                <span class="badge {% if concert.concert_date > now %}bg-success{% else %}bg-secondary{% endif %}">
                                    {% if concert.concert_date > now %}Предстоящий{% else %}Завершен{% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="bi bi-music-note-beamed"></i> Программа выступлений
                    {% if performances %}
                    <span class="badge bg-primary ms-2">{{ performances|length }}</span>
                    {% endif %}
                </h5>
            </div>
            <div class="card-body">
                {% if performances %}
                    <div class="list-group">
                        {% for performance in performances %}
                        <div class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between align-items-start">
                                <div class="me-3">
                                    <span class="badge bg-primary rounded-circle p-2">
                                        {{ performance.performance_order }}
                                    </span>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">{{ performance.band.band_name }}</h6>
                                    {% if performance.band.genre %}
                                    <p class="mb-1 text-muted">
                                        <i class="bi bi-tag"></i> {{ performance.band.genre }}
                                    </p>
                                    {% endif %}
                                    {% if performance.band.founded_date %}
                                    <small class="text-muted">
                                        <i class="bi bi-calendar"></i> Основана в {{ performance.band.founded_date|date:"Y" }}
                                    </small>
                                    {% endif %}
                                </div>
                                <div class="text-end">
                                    <button class="btn btn-sm btn-outline-info" 
                                            data-bs-toggle="collapse" 
                                            data-bs-target="#bandDetails{{ performance.band.band_id }}"
                                            aria-expanded="false">
                                        <i class="bi bi-info-circle"></i> Подробнее
                                    </button>
                                </div>
                            </div>
                            
                          
                            <div class="collapse mt-3" id="bandDetails{{ performance.band.band_id }}">
                                <div class="card card-body">
                                    <h6>Информация о группе:</h6>
                                    <ul class="list-unstyled">
                                        <li><strong>Название:</strong> {{ performance.band.band_name }}</li>
                                        {% if performance.band.genre %}
                                        <li><strong>Жанр:</strong> {{ performance.band.genre }}</li>
                                        {% endif %}
                                        {% if performance.band.founded_date %}
                                        <li><strong>Основана:</strong> {{ performance.band.founded_date|date:"d.m.Y" }}</li>
                                        {% endif %}
                                    </ul>
                                    <small class="text-muted">
                                        <i class="bi bi-clock"></i> Порядок выступления: {{ performance.performance_order }}
                                    </small>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-music-note-list display-1 text-muted"></i>
                        <h5 class="text-muted mt-3">Программа выступлений не определена</h5>
                        <p class="text-muted">Информация о выступлениях будет добавлена позже</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

   
    <div class="col-lg-4">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> Информация</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6><i class="bi bi-calendar3"></i> Статус концерта</h6>
                    <div class="alert {% if concert.concert_date > now %}alert-warning{% else %}alert-light{% endif %}">
                        {% if concert.concert_date > now %}
                            <i class="bi bi-clock"></i> <strong>Предстоящий</strong>
                            <p class="mb-0 small mt-1">
                                Начало: <strong>{{ concert.concert_date|date:"d.m.Y H:i" }}</strong>
                            </p>
                        {% else %}
                            <i class="bi bi-check-circle"></i> <strong>Завершен</strong>
                            <p class="mb-0 small mt-1">
                                Прошел: {{ concert.concert_date|date:"d.m.Y" }}
                            </p>
                        {% endif %}
                    </div>
                </div>

                <div class="mb-3">
                    <h6><i class="bi bi-graph-up"></i> Статистика</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="bi bi-people text-primary"></i>
                            Количество групп: 
                            <span class="badge bg-primary float-end">{{ performances|length }}</span>
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-clock text-success"></i>
                            Дата проведения: 
                            <span class="badge bg-light text-dark float-end">{{ concert.concert_date|date:"d.m.Y" }}</span>
                        </li>
                        {% if concert.concert_date > now %}
                        <li class="mb-2">
                            <i class="bi bi-hourglass text-warning"></i>
                            До начала: 
                            <span class="badge bg-warning text-dark float-end">{{ concert.concert_date|timeuntil }}</span>
                        </li>
                        {% endif %}
                    </ul>
                </div>

                {% if concert.concert_date > now %}
                <div class="mt-4">
                    <h6><i class="bi bi-ticket-perforated"></i> Билеты</h6>
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        Билеты доступны в кассах и онлайн
                        <div class="mt-2">
                            <button class="btn btn-success btn-sm w-100">
                                <i class="bi bi-cart"></i> Купить билет
                            </button>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="bi bi-lightning"></i> Быстрые действия</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'concertsshower:upcoming_concerts' %}" class="btn btn-outline-primary">
                        <i class="bi bi-arrow-left"></i> Назад к концертам
                    </a>
                    <a href="{% url 'concertsshower:all_concerts' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-calendar3"></i> Все концерты
                    </a>
                    <a href="{% url 'book' %}" class="btn btn-outline-success">
                        <i class="bi bi-calendar-plus"></i> Забронировать репетицию
                    </a>
                    <button class="btn btn-outline-info" onclick="window.print()">
                        <i class="bi bi-printer"></i> Распечатать
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="card shadow-sm mt-4">
    <div class="card-header bg-light">
        <h5 class="mb-0"><i class="bi bi-map"></i> Место проведения</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-8">
                <h6>{{ concert.venue_address }}</h6>
                <p class="text-muted">
                    <i class="bi bi-geo-alt"></i> Адрес для навигации
                </p>
                <div class="alert alert-light">
                    <i class="bi bi-info-circle"></i>
                    Для получения точных координатов и схемы проезда обратитесь к организаторам.
                </div>
            </div>
            <div class="col-md-4">
                <div class="text-center">
                    <i class="bi bi-map display-1 text-muted"></i>
                    <p class="mt-2">
                        <button class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-geo-alt"></i> Открыть в картах
                        </button>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`concertsshower/templates/concertsshower/concert_not_found.html`:

```html
{% extends 'concertsshower/base.html' %}

{% block title %}Концерт не найден - Encore{% endblock %}
{% block page_title %}Концерт не найден{% endblock %}
{% block page_subtitle %}Запрашиваемая страница концерта недоступна{% endblock %}

{% block concerts_content %}
<div class="text-center py-5">
    <div class="mb-4">
        <i class="bi bi-emoji-frown display-1 text-danger"></i>
        <i class="bi bi-music-note-beamed display-1 text-muted ms-3"></i>
        <i class="bi bi-emoji-frown display-1 text-danger ms-3"></i>
    </div>
    
    <h1 class="display-4 text-danger mb-4">404</h1>
    <h2 class="mb-4">Концерт не найден</h2>
    
    <div class="alert alert-warning mx-auto" style="max-width: 600px;">
        <i class="bi bi-exclamation-triangle"></i>
        <strong>Возможные причины:</strong>
        <ul class="mt-2 mb-0">
            <li>Концерт был удален или перенесен</li>
            <li>Ссылка устарела или содержит ошибку</li>
            <li>Концерт временно недоступен</li>
        </ul>
    </div>
    
    <p class="lead mb-5">
        Запрашиваемый вами концерт не существует, был удален<br>
        или вы перешли по неверной ссылке.
    </p>
    
    <div class="row justify-content-center g-3">
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <i class="bi bi-calendar-event display-4 text-primary mb-3"></i>
                    <h5 class="card-title">Ближайшие концерты</h5>
                    <p class="card-text">Посмотрите запланированные выступления</p>
                    <a href="{% url 'concertsshower:upcoming_concerts' %}" class="btn btn-primary">
                        <i class="bi bi-arrow-right"></i> Перейти
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <i class="bi bi-calendar3 display-4 text-success mb-3"></i>
                    <h5 class="card-title">Все концерты</h5>
                    <p class="card-text">Полный архив музыкальных событий</p>
                    <a href="{% url 'concertsshower:all_concerts' %}" class="btn btn-success">
                        <i class="bi bi-arrow-right"></i> Перейти
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <i class="bi bi-calendar-plus display-4 text-info mb-3"></i>
                    <h5 class="card-title">Бронирование</h5>
                    <p class="card-text">Забронируйте репетицию для группы</p>
                    <a href="{% url 'book' %}" class="btn btn-info text-white">
                        <i class="bi bi-arrow-right"></i> Перейти
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mt-5 pt-4">
        <p class="text-muted">
            <i class="bi bi-info-circle"></i>
            Если вы уверены, что концерт должен быть доступен,<br>
            свяжитесь с администратором системы.
        </p>
        <a href="/admin/" class="btn btn-outline-secondary">
            <i class="bi bi-gear"></i> Администрирование
        </a>
    </div>
</div>
{% endblock %}
```

`concertsshower/templates/concertsshower/pagination.html`:

```html
{% load concert_filters %}

{% if page_obj.paginator.num_pages > 1 %}
<nav aria-label="Page navigation" class="mt-5">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?{% url_replace page=1 %}" aria-label="First">
                <span aria-hidden="true">&laquo;&laquo;</span>
            </a>
        </li>
        <li class="page-item">
            <a class="page-link" href="?{% url_replace page=page_obj.previous_page_number %}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                <span aria-hidden="true">&laquo;&laquo;</span>
            </a>
        </li>
        <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
            {% if num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                {% if page_obj.number == num %}
                <li class="page-item active" aria-current="page">
                    <span class="page-link">{{ num }}</span>
                </li>
                {% else %}
                <li class="page-item">
                    <a class="page-link" href="?{% url_replace page=num %}">{{ num }}</a>
                </li>
                {% endif %}
            {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link" href="?{% url_replace page=page_obj.next_page_number %}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
        <li class="page-item">
            <a class="page-link" href="?{% url_replace page=page_obj.paginator.num_pages %}" aria-label="Last">
                <span aria-hidden="true">&raquo;&raquo;</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
        <li class="page-item disabled">
            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                <span aria-hidden="true">&raquo;&raquo;</span>
            </a>
        </li>
        {% endif %}
    </ul>
    <div class="text-center text-muted mt-2">
        Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}. 
        Показано {{ page_obj.start_index }}-{{ page_obj.end_index }} из {{ page_obj.paginator.count }} концертов
    </div>
</nav>
{% endif %}
```

`concertsshower/templates/concertsshower/upcoming_concerts.html`:

```html
{% extends 'concertsshower/base.html' %}

{% block title %}Ближайшие концерты - Encore{% endblock %}
{% block page_title %}Ближайшие концерты{% endblock %}
{% block page_subtitle %}Не пропустите важные музыкальные события{% endblock %}

{% block concerts_content %}
{% if concerts %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for concert in concerts %}
        <div class="col">
            <div class="card concert-card h-100 shadow-sm border-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title mb-0">
                            <a href="{% url 'concertsshower:concert_detail' concert.concert_id %}" class="text-decoration-none text-dark">
                                {{ concert.concert_title }}
                            </a>
                        </h5>
                        <span class="badge bg-success">Предстоящий</span>
                    </div>
                    
                    <div class="concert-date mb-3">
                        <i class="bi bi-calendar-event text-primary"></i>
                        <strong>{{ concert.concert_date|date:"d.m.Y" }}</strong>
                        <i class="bi bi-clock text-primary ms-2"></i>
                        {{ concert.concert_date|time:"H:i" }}
                    </div>
                    
                    <div class="concert-venue mb-3">
                        <i class="bi bi-geo-alt text-secondary"></i>
                        <span class="text-muted">{{ concert.venue_address }}</span>
                    </div>

                    <div class="alert alert-info py-2 mb-0">
                        <small>
                            <i class="bi bi-hourglass-split"></i> 
                            Осталось: {{ concert.concert_date|timeuntil }}
                        </small>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-top-0">
                    <a href="{% url 'concertsshower:concert_detail' concert.concert_id %}" class="btn btn-primary w-100">
                        <i class="bi bi-info-circle"></i> Подробнее
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="text-center py-5">
        <i class="bi bi-calendar-x display-1 text-muted"></i>
        <h3 class="text-muted mt-3">Нет запланированных концертов</h3>
        <p class="text-muted">Следите за обновлениями, скоро здесь появится что-то интересное!</p>
        <a href="{% url 'concertsshower:all_concerts' %}" class="btn btn-outline-primary mt-2">
            Посмотреть архив концертов
        </a>
    </div>
{% endif %}
{% endblock %}
```

`concertsshower/templatetags/concert_filters.py`:

```py
from django import template

register = template.Library()

@register.simple_tag(takes_context=True)
def url_replace(context, **kwargs):
    query = context['request'].GET.copy()
    
    for key, value in kwargs.items():
        if value:
            query[key] = str(value)
        elif key in query:
            del query[key]
    
    return query.urlencode()
```

`concertsshower/tests.py`:

```py
from django.test import TestCase
from django.urls import reverse
from core.models import Concert
from django.utils import timezone

class ConcertViewTests(TestCase):
    def setUp(self):
        self.concert = Concert.objects.create(
            concert_title="Mega Rock Fest",
            venue_address="Minsk, Arena",
            concert_date=timezone.now() + timezone.timedelta(days=1)
        )

    def test_upcoming_concerts_view(self):
        url = reverse('concertsshower:upcoming_concerts')
        response = self.client.get(url)
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, "Mega Rock Fest")

    def test_concert_detail_view(self):
        url = reverse('concertsshower:concert_detail', args=[self.concert.concert_id])
        response = self.client.get(url)
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, "Minsk, Arena")
```

`concertsshower/urls.py`:

```py
from django.urls import path
from . import views

app_name = 'concertsshower'

urlpatterns = [
    path('', views.all_concerts, name='all_concerts'),
    
    path('upcoming/', views.upcoming_concerts, name='upcoming_concerts'),
    
    path('<int:pk>/', views.concert_detail, name='concert_detail'),
]
```

`concertsshower/views.py`:

```py
from django.shortcuts import render, get_object_or_404
from django.utils import timezone
from django.core.paginator import Paginator
from django.db.models import Q
from .models import Concert, Performance

def upcoming_concerts(request):
    now = timezone.now()
    
    concerts = Concert.objects.filter(
        concert_date__gte=now
    ).order_by('concert_date')
    
    context = {
        'concerts': concerts,
        'now': now,
    }
    return render(request, 'concertsshower/upcoming_concerts.html', context)

def all_concerts(request):
    now = timezone.now()
    search_query = request.GET.get('search', '')
    from_date = request.GET.get('from_date')
    to_date = request.GET.get('to_date')
    
    concerts_list = Concert.objects.all().order_by('-concert_date')
    
    if search_query:
        concerts_list = concerts_list.filter(
            Q(concert_title__icontains=search_query) | 
            Q(venue_address__icontains=search_query)
        )
    
    if from_date:
        concerts_list = concerts_list.filter(concert_date__date__gte=from_date)
    
    if to_date:
        concerts_list = concerts_list.filter(concert_date__date__lte=to_date)
        
    paginator = Paginator(concerts_list, 9)
    page_number = request.GET.get('page')
    concerts = paginator.get_page(page_number)
    
    context = {
        'concerts': concerts,
        'now': now,
        'search_query': search_query,
        'from_date': from_date,
        'to_date': to_date,
    }
    return render(request, 'concertsshower/all_concerts.html', context)

def concert_detail(request, pk):
    concert = get_object_or_404(Concert, pk=pk)
    performances = concert.performances.all().select_related('band').order_by('performance_order')
    
    context = {
        'concert': concert,
        'performances': performances,
        'now': timezone.now(),
    }
    return render(request, 'concertsshower/concert_detail.html', context)
```

`config/asgi.py`:

```py
"""
ASGI config for config project.
"""

import os
from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')

application = get_asgi_application()

```

`config/settings.py`:

```py
import os
from pathlib import Path

BASE_DIR = Path(__file__).resolve().parent.parent

SECRET_KEY = os.environ.get('SECRET_KEY', 'django-insecure-dev-key')
DEBUG = True
ALLOWED_HOSTS = ['*']

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'core.apps.CoreConfig',  
    'booking.apps.BookingConfig',
    'concertsshower.apps.ConcertsshowerConfig',
    'for_authorization.apps.ForAuthorizationConfig',
    'custom_admin.apps.CustomAdminConfig', 
    'groups.apps.GroupsConfig', 
]

AUTH_USER_MODEL = 'for_authorization.MusicianUser'

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'config.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [BASE_DIR / 'templates'],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'config.wsgi.application'

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'concerts_db',
        'USER': 'postgres',
        'PASSWORD': 'postgres',
        'HOST': 'db',
        'PORT': '5432',
    }
}

AUTH_PASSWORD_VALIDATORS = []

LANGUAGE_CODE = 'ru-ru'
TIME_ZONE = 'Europe/Minsk'
USE_I18N = True
USE_TZ = True

STATIC_URL = 'static/'
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

MEDIA_URL = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'
```

`config/urls.py`:

```py
from django.contrib import admin
from django.urls import path, include
from django.contrib.auth import views as auth_views
from django.conf import settings
from django.conf.urls.static import static
from for_authorization.views import home, custom_login, custom_logout, RegisterView, ProfileView, ProfileUpdateView, change_password

urlpatterns = [
    path('admin/', admin.site.urls),
    path('admin-panel/', include('custom_admin.urls')),
    path('book/', include('booking.urls')),
    path('concerts/', include('concertsshower.urls')),
    path('groups/', include('groups.urls', namespace='groups')),
    
    path('', home, name='home'),
    path('login/', custom_login, name='login'),
    path('logout/', custom_logout, name='logout'),
    path('register/', RegisterView.as_view(), name='register'),
    
    path('profile/', ProfileView.as_view(), name='profile'),
    path('profile/edit/', ProfileUpdateView.as_view(), name='profile_edit'),
    path('profile/change-password/', change_password, name='change_password'),
    
    path('password-reset/', 
         auth_views.PasswordResetView.as_view(
             template_name='core/registration/password_reset.html',
             email_template_name='core/registration/password_reset_email.html'
         ), 
         name='password_reset'),
    path('password-reset/done/', 
         auth_views.PasswordResetDoneView.as_view(
             template_name='core/registration/password_reset_done.html'
         ), 
         name='password_reset_done'),
    path('password-reset-confirm/<uidb64>/<token>/', 
         auth_views.PasswordResetConfirmView.as_view(
             template_name='core/registration/password_reset_confirm.html'
         ), 
         name='password_reset_confirm'),
    path('password-reset-complete/', 
         auth_views.PasswordResetCompleteView.as_view(
             template_name='core/registration/password_reset_complete.html'
         ), 
         name='password_reset_complete'),
]

if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
```

`config/wsgi.py`:

```py
"""
WSGI config for config project.
"""

import os
from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')

application = get_wsgi_application()

```

`core/admin.py`:

```py
from django.contrib import admin
from .models import Musician, Band, Concert, Performance, Rehearsal, BandMembership


@admin.register(Musician)
class MusicianAdmin(admin.ModelAdmin):
    list_display = ('first_name', 'last_name', 'phone', 'instrument', 'telegram')
    list_filter = ('instrument',)
    search_fields = ('first_name', 'last_name', 'phone', 'instrument')


@admin.register(Band)
class BandAdmin(admin.ModelAdmin):
    list_display = ('band_name', 'genre', 'founded_date')
    list_filter = ('genre', 'founded_date')
    search_fields = ('band_name', 'genre')


@admin.register(Concert)
class ConcertAdmin(admin.ModelAdmin):
    list_display = ('concert_title', 'venue_address', 'concert_date')
    list_filter = ('concert_date',)
    search_fields = ('concert_title', 'venue_address')
    date_hierarchy = 'concert_date'


@admin.register(Performance)
class PerformanceAdmin(admin.ModelAdmin):
    list_display = ('concert', 'band', 'performance_order')
    list_filter = ('concert', 'band')
    autocomplete_fields = ['concert', 'band']


@admin.register(Rehearsal)
class RehearsalAdmin(admin.ModelAdmin):
    list_display = ('band', 'rehearsal_date', 'duration_minutes', 'location')
    list_filter = ('band', 'rehearsal_date')
    search_fields = ('location', 'band__band_name')
    date_hierarchy = 'rehearsal_date'


@admin.register(BandMembership)
class BandMembershipAdmin(admin.ModelAdmin):
    list_display = ('musician', 'band', 'join_date')
    list_filter = ('band', 'join_date')
    search_fields = ('musician__first_name', 'musician__last_name', 'band__band_name')
    autocomplete_fields = ['musician', 'band']

```

`core/apps.py`:

```py
from django.apps import AppConfig


class CoreConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'core'

```

`core/forms.py`:

```py
from django import forms
from django.core.exceptions import ValidationError
from django.utils import timezone
from .models import Musician, Band, Concert, BandMembership


class MusicianForm(forms.ModelForm):
    class Meta:
        model = Musician
        fields = '__all__'
    
    def clean_phone(self):
        phone = self.cleaned_data.get('phone')
        if not phone.startswith('+375'):
            raise ValidationError('Phone must start with +375')
        if len(phone) != 13:
            raise ValidationError('Phone must be 13 characters long')
        return phone
    
    def clean_telegram(self):
        telegram = self.cleaned_data.get('telegram')
        if telegram and not telegram.startswith('@'):
            raise ValidationError('Telegram username must start with @')
        return telegram


class BandForm(forms.ModelForm):
    class Meta:
        model = Band
        fields = '__all__'
        widgets = {
            'founded_date': forms.DateInput(attrs={'type': 'date'}),
        }
    
    def clean_founded_date(self):
        founded_date = self.cleaned_data.get('founded_date')
        if founded_date > timezone.now().date():
            raise ValidationError('Founded date cannot be in the future')
        return founded_date


class ConcertForm(forms.ModelForm):
    class Meta:
        model = Concert
        fields = '__all__'
        widgets = {
            'concert_date': forms.DateTimeInput(attrs={'type': 'datetime-local'}),
        }
    
    def clean_concert_date(self):
        concert_date = self.cleaned_data.get('concert_date')
        if concert_date < timezone.now():
            raise ValidationError('Concert date cannot be in the past')
        return concert_date


class BandMembershipForm(forms.ModelForm):
    class Meta:
        model = BandMembership
        fields = '__all__'
        widgets = {
            'join_date': forms.DateInput(attrs={'type': 'date'}),
        }
    
    def clean_join_date(self):
        join_date = self.cleaned_data.get('join_date')
        if join_date > timezone.now().date():
            raise ValidationError('Join date cannot be in the future')
        return join_date

```

`core/migrations/0001_initial.py`:

```py
# Generated by Django 5.2.9 on 2025-12-16 20:28

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='Band',
            fields=[
                ('band_id', models.AutoField(primary_key=True, serialize=False)),
                ('band_name', models.CharField(max_length=100)),
                ('genre', models.CharField(choices=[('rock', 'Rock'), ('pop', 'Pop'), ('jazz', 'Jazz'), ('blues', 'Blues'), ('classical', 'Classical'), ('electronic', 'Electronic'), ('folk', 'Folk'), ('metal', 'Metal'), ('punk', 'Punk'), ('reggae', 'Reggae'), ('hip-hop', 'Hip-Hop'), ('country', 'Country'), ('funk', 'Funk'), ('soul', 'Soul'), ('r&b', 'R&B'), ('alternative', 'Alternative'), ('indie', 'Indie'), ('hard_rock', 'Hard Rock'), ('progressive', 'Progressive'), ('house', 'House'), ('techno', 'Techno')], max_length=50)),
                ('founded_date', models.DateField(default=django.utils.timezone.now)),
            ],
            options={
                'db_table': 'bands',
            },
        ),
        migrations.CreateModel(
            name='Concert',
            fields=[
                ('concert_id', models.AutoField(primary_key=True, serialize=False)),
                ('concert_title', models.CharField(max_length=200)),
                ('venue_address', models.CharField(max_length=255)),
                ('concert_date', models.DateTimeField(default=django.utils.timezone.now)),
            ],
            options={
                'db_table': 'concerts',
            },
        ),
        migrations.CreateModel(
            name='Musician',
            fields=[
                ('musician_id', models.AutoField(primary_key=True, serialize=False)),
                ('first_name', models.CharField(max_length=50)),
                ('last_name', models.CharField(max_length=50)),
                ('phone', models.CharField(max_length=20, unique=True, validators=[django.core.validators.RegexValidator(message='Phone must be in format +375XXXXXXXXX', regex='^\\+375[0-9]{9}$')])),
                ('telegram', models.CharField(blank=True, max_length=100, null=True, validators=[django.core.validators.RegexValidator(message='Telegram must start with @', regex='^@.+')])),
                ('instrument', models.CharField(choices=[('guitar', 'Guitar'), ('bass', 'Bass'), ('drums', 'Drums'), ('keyboards', 'Keyboards'), ('piano', 'Piano'), ('vocals', 'Vocals'), ('violin', 'Violin'), ('cello', 'Cello'), ('trumpet', 'Trumpet'), ('saxophone', 'Saxophone'), ('trombone', 'Trombone'), ('flute', 'Flute'), ('clarinet', 'Clarinet'), ('accordion', 'Accordion'), ('harp', 'Harp')], max_length=50)),
            ],
            options={
                'db_table': 'musicians',
            },
        ),
        migrations.CreateModel(
            name='Performance',
            fields=[
                ('performance_id', models.AutoField(primary_key=True, serialize=False)),
                ('performance_order', models.PositiveIntegerField()),
                ('band', models.ForeignKey(db_column='band_id', on_delete=django.db.models.deletion.CASCADE, to='core.band')),
                ('concert', models.ForeignKey(db_column='concert_id', on_delete=django.db.models.deletion.CASCADE, to='core.concert')),
            ],
            options={
                'db_table': 'performances',
            },
        ),
        migrations.CreateModel(
            name='Rehearsal',
            fields=[
                ('rehearsal_id', models.AutoField(primary_key=True, serialize=False)),
                ('rehearsal_date', models.DateTimeField(default=django.utils.timezone.now)),
                ('duration_minutes', models.PositiveIntegerField()),
                ('location', models.CharField(max_length=255)),
                ('band', models.ForeignKey(db_column='band_id', on_delete=django.db.models.deletion.CASCADE, to='core.band')),
            ],
            options={
                'db_table': 'rehearsals',
            },
        ),
        migrations.CreateModel(
            name='BandMembership',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('join_date', models.DateField(default=django.utils.timezone.now)),
                ('band', models.ForeignKey(db_column='band_id', on_delete=django.db.models.deletion.CASCADE, to='core.band')),
                ('musician', models.ForeignKey(db_column='musician_id', on_delete=django.db.models.deletion.CASCADE, to='core.musician')),
            ],
            options={
                'db_table': 'band_membership',
                'unique_together': {('band', 'musician')},
            },
        ),
    ]

```

`core/migrations/0002_band_logo.py`:

```py
# Generated by Django 5.2.9 on 2025-12-25 17:42

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0001_initial'),
    ]

    operations = [
        migrations.AddField(
            model_name='band',
            name='logo',
            field=models.ImageField(blank=True, null=True, upload_to='band_logos/', verbose_name='Логотип'),
        ),
    ]

```

`core/models.py`:

```py
from django.db import models
from django.core.validators import RegexValidator
from django.utils import timezone


class Musician(models.Model):
    INSTRUMENT_CHOICES = [
        ('guitar', 'Guitar'),
        ('bass', 'Bass'),
        ('drums', 'Drums'),
        ('keyboards', 'Keyboards'),
        ('piano', 'Piano'),
        ('vocals', 'Vocals'),
        ('violin', 'Violin'),
        ('cello', 'Cello'),
        ('trumpet', 'Trumpet'),
        ('saxophone', 'Saxophone'),
        ('trombone', 'Trombone'),
        ('flute', 'Flute'),
        ('clarinet', 'Clarinet'),
        ('accordion', 'Accordion'),
        ('harp', 'Harp'),
    ]
    
    musician_id = models.AutoField(primary_key=True)
    first_name = models.CharField(max_length=50)
    last_name = models.CharField(max_length=50)
    phone = models.CharField(
        max_length=20,
        unique=True,
        validators=[
            RegexValidator(
                regex=r'^\+375[0-9]{9}$',
                message='Phone must be in format +375XXXXXXXXX'
            )
        ]
    )
    telegram = models.CharField(
        max_length=100,
        blank=True,
        null=True,
        validators=[
            RegexValidator(
                regex=r'^@.+',
                message='Telegram must start with @'
            )
        ]
    )
    instrument = models.CharField(max_length=50, choices=INSTRUMENT_CHOICES)
    
    class Meta:
        db_table = 'musicians'
    
    def __str__(self):
        return f"{self.first_name} {self.last_name} ({self.instrument})"


class Band(models.Model):
    GENRE_CHOICES = [
        ('rock', 'Rock'),
        ('pop', 'Pop'),
        ('jazz', 'Jazz'),
        ('blues', 'Blues'),
        ('classical', 'Classical'),
        ('electronic', 'Electronic'),
        ('folk', 'Folk'),
        ('metal', 'Metal'),
        ('punk', 'Punk'),
        ('reggae', 'Reggae'),
        ('hip-hop', 'Hip-Hop'),
        ('country', 'Country'),
        ('funk', 'Funk'),
        ('soul', 'Soul'),
        ('r&b', 'R&B'),
        ('alternative', 'Alternative'),
        ('indie', 'Indie'),
        ('hard_rock', 'Hard Rock'),
        ('progressive', 'Progressive'),
        ('house', 'House'),
        ('techno', 'Techno'),
    ]
    
    band_id = models.AutoField(primary_key=True)
    band_name = models.CharField(max_length=100)
    genre = models.CharField(max_length=50, choices=GENRE_CHOICES)
    founded_date = models.DateField(default=timezone.now)
    logo = models.ImageField(upload_to='band_logos/', blank=True, null=True, verbose_name='Логотип')
    
    class Meta:
        db_table = 'bands'
    
    def __str__(self):
        return f"{self.band_name} ({self.genre})"


class Concert(models.Model):
    concert_id = models.AutoField(primary_key=True)
    concert_title = models.CharField(max_length=200)
    venue_address = models.CharField(max_length=255)
    concert_date = models.DateTimeField(default=timezone.now)
    
    class Meta:
        db_table = 'concerts'
    
    def __str__(self):
        return f"{self.concert_title} at {self.venue_address}"


class Performance(models.Model):
    performance_id = models.AutoField(primary_key=True)
    band = models.ForeignKey(Band, on_delete=models.CASCADE, db_column='band_id')
    concert = models.ForeignKey(Concert, on_delete=models.CASCADE, db_column='concert_id')
    performance_order = models.PositiveIntegerField()
    
    class Meta:
        db_table = 'performances'
    
    def __str__(self):
        return f"{self.band} at {self.concert} (order: {self.performance_order})"


class Rehearsal(models.Model):
    rehearsal_id = models.AutoField(primary_key=True)
    band = models.ForeignKey(Band, on_delete=models.CASCADE, db_column='band_id')
    rehearsal_date = models.DateTimeField(default=timezone.now)
    duration_minutes = models.PositiveIntegerField()
    location = models.CharField(max_length=255)
    
    class Meta:
        db_table = 'rehearsals'
    
    def __str__(self):
        return f"{self.band} rehearsal at {self.location}"


class BandMembership(models.Model):
    band = models.ForeignKey(Band, on_delete=models.CASCADE, db_column='band_id')
    musician = models.ForeignKey(Musician, on_delete=models.CASCADE, db_column='musician_id')
    join_date = models.DateField(default=timezone.now)
    
    class Meta:
        db_table = 'band_membership'
        unique_together = ('band', 'musician')
    
    def __str__(self):
        return f"{self.musician} in {self.band} since {self.join_date}"
```

`custom_admin/admin.py`:

```py
from django.contrib import admin

# Register your models here.

```

`custom_admin/apps.py`:

```py
from django.apps import AppConfig


class CustomAdminConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'custom_admin'
    verbose_name = 'Кастомная админ-панель'
```

`custom_admin/forms.py`:

```py
from django import forms
from django.utils import timezone
from core.models import Rehearsal, Performance
from core.forms import MusicianForm, BandForm, ConcertForm, BandMembershipForm


class RehearsalForm(forms.ModelForm):
    class Meta:
        model = Rehearsal
        fields = ['band', 'rehearsal_date', 'duration_minutes', 'location']
        widgets = {
            'rehearsal_date': forms.DateTimeInput(attrs={
                'type': 'datetime-local',
                'class': 'form-control'
            }),
            'duration_minutes': forms.NumberInput(attrs={
                'class': 'form-control',
                'min': 15,
                'step': 15
            }),
            'location': forms.TextInput(attrs={
                'class': 'form-control',
                'placeholder': 'Введите место проведения'
            }),
            'band': forms.Select(attrs={'class': 'form-control'})
        }
    
    def clean_rehearsal_date(self):
        rehearsal_date = self.cleaned_data.get('rehearsal_date')
        if rehearsal_date and rehearsal_date < timezone.now():
            raise forms.ValidationError('Дата репетиции не может быть в прошлом')
        return rehearsal_date
    
    def clean_duration_minutes(self):
        duration = self.cleaned_data.get('duration_minutes')
        if duration and duration < 15:
            raise forms.ValidationError('Минимальная продолжительность репетиции - 15 минут')
        if duration and duration > 480:
            raise forms.ValidationError('Максимальная продолжительность репетиции - 8 часов (480 минут)')
        return duration


class PerformanceForm(forms.ModelForm):
    class Meta:
        model = Performance
        fields = ['concert', 'band', 'performance_order']
        widgets = {
            'concert': forms.Select(attrs={'class': 'form-control'}),
            'band': forms.Select(attrs={'class': 'form-control'}),
            'performance_order': forms.NumberInput(attrs={
                'class': 'form-control',
                'min': 1
            })
        }
    
    def clean_performance_order(self):
        order = self.cleaned_data.get('performance_order')
        concert = self.cleaned_data.get('concert')
        band = self.cleaned_data.get('band')
        
        if concert and band and order:
            existing = Performance.objects.filter(
                concert=concert,
                performance_order=order
            )
            
            if self.instance and self.instance.pk:
                existing = existing.exclude(pk=self.instance.pk)
            else:
                existing = existing.exclude(band=band)
            
            if existing.exists():
                raise forms.ValidationError('Этот порядок уже занят другим выступлением на этом концерте')
        
        return order


__all__ = [
    'MusicianForm', 'BandForm', 'ConcertForm', 'BandMembershipForm',
    'RehearsalForm', 'PerformanceForm'
]
```

`custom_admin/models.py`:

```py
from django.db import models

# Create your models here.

```

`custom_admin/templates/custom_admin/bands/confirm_delete.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Подтверждение удаления</h5>
    </div>
    <div class="card-body">
        <p>Вы уверены, что хотите удалить <strong>{{ object }}</strong>?</p>
        <form method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash"></i> Удалить
            </button>
        </form>
        <a href="{% url 'custom_admin:band_list' %}" class="btn btn-outline-secondary ms-2">
            <i class="bi bi-x-circle"></i> Отмена
        </a>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/bands/form.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-pencil"></i> {{ title }}</h5>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}
            <div class="row">
                {% for field in form %}
                <div class="col-md-6 mb-3">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.help_text %}
                        <small class="form-text text-muted">{{ field.help_text }}</small>
                    {% endif %}
                    {% for error in field.errors %}
                        <div class="text-danger">{{ error }}</div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save"></i> Сохранить
                </button>
                <a href="{% url 'custom_admin:band_list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle"></i> Отмена
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/bands/list.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4><i class="bi bi-music-note-beamed"></i> Группы</h4>
    <a href="{% url 'custom_admin:band_create' %}" class="btn btn-sm btn-success">
        <i class="bi bi-plus-circle"></i> Добавить
    </a>
</div>

{% if bands %}
<div class="table-responsive">
    <table class="table table-hover table-striped">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>Название</th>
                <th>Жанр</th>
                <th>Дата основания</th>
                <th>Участников</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for band in bands %}
            <tr>
                <td><span class="badge bg-secondary">{{ band.band_id }}</span></td>
                <td>{{ band.band_name }}</td>
                <td>
                    <span class="badge bg-info">{{ band.get_genre_display }}</span>
                </td>
                <td>{{ band.founded_date|date:"d.m.Y" }}</td>
                <td>
                    <span class="badge bg-primary">{{ band.bandmembership_set.count }}</span>
                </td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{% url 'custom_admin:band_update' band.pk %}" 
                           class="btn btn-outline-primary" title="Редактировать">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <a href="{% url 'custom_admin:band_delete' band.pk %}" 
                           class="btn btn-outline-danger" title="Удалить">
                            <i class="bi bi-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="text-center py-5">
    <i class="bi bi-people display-1 text-muted"></i>
    <h4 class="mt-3">Нет групп</h4>
    <p class="text-muted">Начните с добавления первой музыкальной группы</p>
    <a href="{% url 'custom_admin:band_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Добавить группу
    </a>
</div>
{% endif %}
{% endblock %}
```

`custom_admin/templates/custom_admin/base.html`:

```html
{% extends "base.html" %}
{% block content %}
<div class="row">
    <nav class="col-md-2 d-none d-md-block bg-light sidebar">
        <div class="position-sticky pt-3">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link{% if request.resolver_match.url_name == 'dashboard' %} active{% endif %}" 
                       href="{% url 'custom_admin:dashboard' %}">
                        <i class="bi bi-speedometer2"></i> Главная
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link{% if 'musician' in request.resolver_match.url_name %} active{% endif %}" 
                       href="{% url 'custom_admin:musician_list' %}">
                        <i class="bi bi-person"></i> Музыканты
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link{% if 'band' in request.resolver_match.url_name %} active{% endif %}" 
                       href="{% url 'custom_admin:band_list' %}">
                        <i class="bi bi-people"></i> Группы
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link{% if 'concert' in request.resolver_match.url_name %} active{% endif %}" 
                       href="{% url 'custom_admin:concert_list' %}">
                        <i class="bi bi-megaphone"></i> Концерты
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link{% if 'performance' in request.resolver_match.url_name %} active{% endif %}" 
                       href="{% url 'custom_admin:performance_list' %}">
                        <i class="bi bi-music-note-beamed"></i> Выступления
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link{% if 'rehearsal' in request.resolver_match.url_name %} active{% endif %}" 
                       href="{% url 'custom_admin:rehearsal_list' %}">
                        <i class="bi bi-calendar-check"></i> Репетиции
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link{% if 'membership' in request.resolver_match.url_name %} active{% endif %}" 
                       href="{% url 'custom_admin:membership_list' %}">
                        <i class="bi bi-person-plus"></i> Членства
                    </a>
                </li>
            </ul>
        </div>
    </nav>
    <main class="col-md-10 ms-sm-auto col-lg-10 px-md-4 py-4">
        {% block admin_content %}{% endblock %}
    </main>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/concerts/confirm_delete.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Подтверждение удаления</h5>
    </div>
    <div class="card-body">
        <p>Вы уверены, что хотите удалить <strong>{{ object }}</strong>?</p>
        <form method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash"></i> Удалить
            </button>
        </form>
        <a href="{% url 'custom_admin:concert_list' %}" class="btn btn-outline-secondary ms-2">
            <i class="bi bi-x-circle"></i> Отмена
        </a>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/concerts/form.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-pencil"></i> {{ title }}</h5>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}
            <div class="row">
                {% for field in form %}
                <div class="col-md-6 mb-3">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.help_text %}
                        <small class="form-text text-muted">{{ field.help_text }}</small>
                    {% endif %}
                    {% for error in field.errors %}
                        <div class="text-danger">{{ error }}</div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save"></i> Сохранить
                </button>
                <a href="{% url 'custom_admin:concert_list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle"></i> Отмена
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/concerts/list.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4><i class="bi bi-megaphone"></i> Концерты</h4>
    <a href="{% url 'custom_admin:concert_create' %}" class="btn btn-sm btn-success">
        <i class="bi bi-plus-circle"></i> Добавить
    </a>
</div>

{% if concerts %}
<div class="table-responsive">
    <table class="table table-hover table-striped">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>Название</th>
                <th>Адрес</th>
                <th>Дата</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for concert in concerts %}
            <tr>
                <td><span class="badge bg-secondary">{{ concert.concert_id }}</span></td>
                <td>{{ concert.concert_title }}</td>
                <td>{{ concert.venue_address }}</td>
                <td>{{ concert.concert_date|date:"d.m.Y H:i" }}</td>
                <td>
                    <a href="{% url 'custom_admin:concert_update' concert.pk %}" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-pencil"></i>
                    </a>
                    <a href="{% url 'custom_admin:concert_delete' concert.pk %}" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-trash"></i>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="text-center py-5">
    <i class="bi bi-calendar-x display-1 text-muted"></i>
    <h4 class="mt-3">Нет концертов</h4>
    <p class="text-muted">Начните с добавления первого концерта</p>
    <a href="{% url 'custom_admin:concert_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Добавить концерт
    </a>
</div>
{% endif %}
{% endblock %}
```

`custom_admin/templates/custom_admin/dashboard.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-speedometer2"></i> Административная панель</h2>
    <span class="badge bg-primary">Версия 1.0</span>
</div>

<div class="alert alert-info">
    <i class="bi bi-info-circle"></i> Панель предназначена для управления основными сущностями системы Encore.
</div>

<!-- Карточки статистики -->
<div class="row mb-5">
    <div class="col-md-2 col-sm-4 mb-3">
        <div class="card text-bg-primary">
            <div class="card-body text-center">
                <i class="bi bi-people display-6 mb-2"></i>
                <h6 class="card-title mb-1">Музыканты</h6>
                <p class="card-text display-5 mb-0">{{ counts.musicians }}</p>
            </div>
            <a href="{% url 'custom_admin:musician_list' %}" class="stretched-link"></a>
        </div>
    </div>
    
    <div class="col-md-2 col-sm-4 mb-3">
        <div class="card text-bg-success">
            <div class="card-body text-center">
                <i class="bi bi-music-note-beamed display-6 mb-2"></i>
                <h6 class="card-title mb-1">Группы</h6>
                <p class="card-text display-5 mb-0">{{ counts.bands }}</p>
            </div>
            <a href="{% url 'custom_admin:band_list' %}" class="stretched-link"></a>
        </div>
    </div>
    
    <div class="col-md-2 col-sm-4 mb-3">
        <div class="card text-bg-warning">
            <div class="card-body text-center">
                <i class="bi bi-megaphone display-6 mb-2"></i>
                <h6 class="card-title mb-1">Концерты</h6>
                <p class="card-text display-5 mb-0">{{ counts.concerts }}</p>
            </div>
            <a href="{% url 'custom_admin:concert_list' %}" class="stretched-link"></a>
        </div>
    </div>
    
    <div class="col-md-2 col-sm-4 mb-3">
        <div class="card text-bg-info">
            <div class="card-body text-center">
                <i class="bi bi-calendar-check display-6 mb-2"></i>
                <h6 class="card-title mb-1">Репетиции</h6>
                <p class="card-text display-5 mb-0">{{ counts.rehearsals }}</p>
            </div>
            <a href="{% url 'custom_admin:rehearsal_list' %}" class="stretched-link"></a>
        </div>
    </div>
    
    <div class="col-md-2 col-sm-4 mb-3">
        <div class="card text-bg-secondary">
            <div class="card-body text-center">
                <i class="bi bi-person-plus display-6 mb-2"></i>
                <h6 class="card-title mb-1">Членства</h6>
                <p class="card-text display-5 mb-0">{{ counts.memberships }}</p>
            </div>
            <a href="{% url 'custom_admin:membership_list' %}" class="stretched-link"></a>
        </div>
    </div>
    
    <div class="col-md-2 col-sm-4 mb-3">
        <div class="card text-bg-dark">
            <div class="card-body text-center">
                <i class="bi bi-music-note-beamed display-6 mb-2"></i>
                <h6 class="card-title mb-1">Выступления</h6>
                <p class="card-text display-5 mb-0">{{ counts.performances }}</p>
            </div>
            <a href="{% url 'custom_admin:performance_list' %}" class="stretched-link"></a>
        </div>
    </div>
</div>

<!-- Быстрые действия -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-lightning"></i> Быстрые действия</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-2 mb-2">
                        <a href="{% url 'custom_admin:musician_create' %}" class="btn btn-outline-primary w-100">
                            <i class="bi bi-person-plus"></i> Новый музыкант
                        </a>
                    </div>
                    <div class="col-md-2 mb-2">
                        <a href="{% url 'custom_admin:band_create' %}" class="btn btn-outline-success w-100">
                            <i class="bi bi-plus-circle"></i> Новая группа
                        </a>
                    </div>
                    <div class="col-md-2 mb-2">
                        <a href="{% url 'custom_admin:concert_create' %}" class="btn btn-outline-warning w-100">
                            <i class="bi bi-calendar-plus"></i> Новый концерт
                        </a>
                    </div>
                    <div class="col-md-2 mb-2">
                        <a href="{% url 'custom_admin:performance_create' %}" class="btn btn-outline-info w-100">
                            <i class="bi bi-music-note-beamed"></i> Новое выступление
                        </a>
                    </div>
                    <div class="col-md-2 mb-2">
                        <a href="{% url 'custom_admin:rehearsal_create' %}" class="btn btn-outline-info w-100">
                            <i class="bi bi-calendar-check"></i> Новая репетиция
                        </a>
                    </div>
                    <div class="col-md-2 mb-2">
                        <a href="{% url 'custom_admin:membership_create' %}" class="btn btn-outline-secondary w-100">
                            <i class="bi bi-link"></i> Новое членство
                        </a>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-6">
                        <a href="/admin/" class="btn btn-outline-dark w-100">
                            <i class="bi bi-gear"></i> Стандартная админка Django
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="{% url 'home' %}" class="btn btn-outline-primary w-100">
                            <i class="bi bi-house"></i> На главную сайта
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/membership/confirm_delete.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Подтверждение удаления</h5>
    </div>
    <div class="card-body">
        <p>Вы уверены, что хотите удалить <strong>{{ object }}</strong>?</p>
        <form method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash"></i> Удалить
            </button>
        </form>
        <a href="{% url 'custom_admin:membership_list' %}" class="btn btn-outline-secondary ms-2">
            <i class="bi bi-x-circle"></i> Отмена
        </a>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/membership/form.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-pencil"></i> {{ title }}</h5>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}
            <div class="row">
                {% for field in form %}
                <div class="col-md-6 mb-3">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.help_text %}
                        <small class="form-text text-muted">{{ field.help_text }}</small>
                    {% endif %}
                    {% for error in field.errors %}
                        <div class="text-danger">{{ error }}</div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save"></i> Сохранить
                </button>
                <a href="{% url 'custom_admin:membership_list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle"></i> Отмена
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/membership/list.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4><i class="bi bi-person-lines-fill"></i> Членства</h4>
    <a href="{% url 'custom_admin:membership_create' %}" class="btn btn-sm btn-success">
        <i class="bi bi-plus-circle"></i> Добавить
    </a>
</div>

{% if memberships %}
<div class="table-responsive">
    <table class="table table-hover table-striped">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>Музыкант</th>
                <th>Группа</th>
                <th>Дата вступления</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for membership in memberships %}
            <tr>
                <td><span class="badge bg-secondary">{{ membership.id }}</span></td>
                <td>{{ membership.musician.first_name }} {{ membership.musician.last_name }}</td>
                <td>{{ membership.band.band_name }}</td>
                <td>{{ membership.join_date|date:"d.m.Y" }}</td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{% url 'custom_admin:membership_update' membership.pk %}" 
                           class="btn btn-outline-primary" title="Редактировать">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <a href="{% url 'custom_admin:membership_delete' membership.pk %}" 
                           class="btn btn-outline-danger" title="Удалить">
                            <i class="bi bi-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="text-center py-5">
    <i class="bi bi-link display-1 text-muted"></i>
    <h4 class="mt-3">Нет членств</h4>
    <p class="text-muted">Начните с добавления первого членства</p>
    <a href="{% url 'custom_admin:membership_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Добавить членство
    </a>
</div>
{% endif %}
{% endblock %}
```

`custom_admin/templates/custom_admin/musicians/confirm_delete.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Подтверждение удаления</h5>
    </div>
    <div class="card-body">
        <p>Вы уверены, что хотите удалить <strong>{{ object }}</strong>?</p>
        <form method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash"></i> Удалить
            </button>
        </form>
        <a href="{% url 'custom_admin:musician_list' %}" class="btn btn-outline-secondary ms-2">
            <i class="bi bi-x-circle"></i> Отмена
        </a>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/musicians/form.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-pencil"></i> {{ title }}</h5>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}
            <div class="row">
                {% for field in form %}
                <div class="col-md-6 mb-3">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.help_text %}
                        <small class="form-text text-muted">{{ field.help_text }}</small>
                    {% endif %}
                    {% for error in field.errors %}
                        <div class="text-danger">{{ error }}</div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save"></i> Сохранить
                </button>
                <a href="{% url 'custom_admin:musician_list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle"></i> Отмена
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/musicians/list.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4><i class="bi bi-people"></i> Музыканты</h4>
    <a href="{% url 'custom_admin:musician_create' %}" class="btn btn-sm btn-success">
        <i class="bi bi-plus-circle"></i> Добавить
    </a>
</div>

{% if musicians %}
<div class="table-responsive">
    <table class="table table-hover table-striped">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>Имя</th>
                <th>Фамилия</th>
                <th>Телефон</th>
                <th>Инструмент</th>
                <th>Telegram</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for m in musicians %}
            <tr>
                <td><span class="badge bg-secondary">{{ m.musician_id }}</span></td>
                <td>{{ m.first_name }}</td>
                <td>{{ m.last_name }}</td>
                <td>{{ m.phone }}</td>
                <td>{{ m.get_instrument_display }}</td>
                <td>{{ m.telegram|default:"—" }}</td>
                <td>
                    <a href="{% url 'custom_admin:musician_update' m.pk %}" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-pencil"></i>
                    </a>
                    <a href="{% url 'custom_admin:musician_delete' m.pk %}" class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-trash"></i>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="text-center py-5">
    <i class="bi bi-emoji-frown display-1 text-muted"></i>
    <h4 class="mt-3">Нет музыкантов</h4>
</div>
{% endif %}
{% endblock %}
```

`custom_admin/templates/custom_admin/performances/confirm_delete.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Подтверждение удаления</h5>
    </div>
    <div class="card-body">
        <p>Вы уверены, что хотите удалить выступление <strong>{{ object }}</strong>?</p>
        <p class="text-muted small">
            Концерт: {{ object.concert.concert_title }}<br>
            Группа: {{ object.band.band_name }}<br>
            Порядок: {{ object.performance_order }}
        </p>
        <form method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash"></i> Удалить
            </button>
        </form>
        <a href="{% url 'custom_admin:performance_list' %}" class="btn btn-outline-secondary ms-2">
            <i class="bi bi-x-circle"></i> Отмена
        </a>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/performances/form.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-pencil"></i> {{ title }}</h5>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}
            <div class="row">
                {% for field in form %}
                <div class="col-md-6 mb-3">
                    <label for="{{ field.id_for_label }}" class="form-label fw-bold">
                        {{ field.label }}
                        {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
                    </label>
                    {{ field }}
                    {% if field.help_text %}
                        <small class="form-text text-muted">{{ field.help_text }}</small>
                    {% endif %}
                    {% for error in field.errors %}
                        <div class="text-danger">{{ error }}</div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save"></i> Сохранить
                </button>
                <a href="{% url 'custom_admin:performance_list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle"></i> Отмена
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/performances/list.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4><i class="bi bi-music-note-beamed"></i> Выступления групп в концертах</h4>
    <a href="{% url 'custom_admin:performance_create' %}" class="btn btn-sm btn-success">
        <i class="bi bi-plus-circle"></i> Добавить
    </a>
</div>

{% if performances %}
<div class="table-responsive">
    <table class="table table-hover table-striped">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>Концерт</th>
                <th>Группа</th>
                <th>Порядок</th>
                <th>Дата концерта</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for performance in performances %}
            <tr>
                <td><span class="badge bg-secondary">{{ performance.performance_id }}</span></td>
                <td>{{ performance.concert.concert_title }}</td>
                <td>{{ performance.band.band_name }}</td>
                <td>
                    <span class="badge bg-primary">{{ performance.performance_order }}</span>
                </td>
                <td>{{ performance.concert.concert_date|date:"d.m.Y H:i" }}</td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{% url 'custom_admin:performance_update' performance.pk %}" 
                           class="btn btn-outline-primary" title="Редактировать">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <a href="{% url 'custom_admin:performance_delete' performance.pk %}" 
                           class="btn btn-outline-danger" title="Удалить">
                            <i class="bi bi-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="text-center py-5">
    <i class="bi bi-music-note-list display-1 text-muted"></i>
    <h4 class="mt-3">Нет выступлений</h4>
    <p class="text-muted">Начните с добавления первого выступления группы в концерт</p>
    <a href="{% url 'custom_admin:performance_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Добавить выступление
    </a>
</div>
{% endif %}
{% endblock %}
```

`custom_admin/templates/custom_admin/rehearsals/confirm_delete.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Подтверждение удаления</h5>
    </div>
    <div class="card-body">
        <p>Вы уверены, что хотите удалить <strong>{{ object }}</strong>?</p>
        <form method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash"></i> Удалить
            </button>
        </form>
        <a href="{% url 'custom_admin:rehearsal_list' %}" class="btn btn-outline-secondary ms-2">
            <i class="bi bi-x-circle"></i> Отмена
        </a>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/rehearsals/form.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="card shadow">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-pencil"></i> {{ title }}</h5>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}
            <div class="row">
                {% for field in form %}
                <div class="col-md-6 mb-3">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.help_text %}
                        <small class="form-text text-muted">{{ field.help_text }}</small>
                    {% endif %}
                    {% for error in field.errors %}
                        <div class="text-danger">{{ error }}</div>
                    {% endfor %}
                </div>
                {% endfor %}
            </div>
            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save"></i> Сохранить
                </button>
                <a href="{% url 'custom_admin:rehearsal_list' %}" class="btn btn-outline-secondary">
                    <i class="bi bi-x-circle"></i> Отмена
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
```

`custom_admin/templates/custom_admin/rehearsals/list.html`:

```html
{% extends "custom_admin/base.html" %}
{% block admin_content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h4><i class="bi bi-calendar2-check"></i> Репетиции</h4>
    <a href="{% url 'custom_admin:rehearsal_create' %}" class="btn btn-sm btn-success">
        <i class="bi bi-plus-circle"></i> Добавить
    </a>
</div>

{% if rehearsals %}
<div class="table-responsive">
    <table class="table table-hover table-striped">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>Группа</th>
                <th>Дата и время</th>
                <th>Длительность</th>
                <th>Место</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for rehearsal in rehearsals %}
            <tr>
                <td><span class="badge bg-secondary">{{ rehearsal.rehearsal_id }}</span></td>
                <td>
                    {% if rehearsal.band %}
                        {{ rehearsal.band.band_name }}
                    {% else %}
                        <span class="text-muted">Группа удалена</span>
                    {% endif %}
                </td>
                <td>{{ rehearsal.rehearsal_date|date:"d.m.Y H:i" }}</td>
                <td>
                    <span class="badge bg-warning text-dark">
                        {{ rehearsal.duration_minutes }} мин.
                    </span>
                </td>
                <td>{{ rehearsal.location|truncatechars:30 }}</td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{% url 'custom_admin:rehearsal_update' rehearsal.pk %}" 
                           class="btn btn-outline-primary" title="Редактировать">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <a href="{% url 'custom_admin:rehearsal_delete' rehearsal.pk %}" 
                           class="btn btn-outline-danger" title="Удалить">
                            <i class="bi bi-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="text-center py-5">
    <i class="bi bi-calendar-x display-1 text-muted"></i>
    <h4 class="mt-3">Нет репетиций</h4>
    <p class="text-muted">Начните с добавления первой репетиции</p>
    <a href="{% url 'custom_admin:rehearsal_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Добавить репетицию
    </a>
</div>
{% endif %}
{% endblock %}
```

`custom_admin/tests.py`:

```py
from django.test import TestCase, Client
from django.urls import reverse
from django.contrib.auth import get_user_model
from django.contrib.auth.models import Permission
from django.core.files.uploadedfile import SimpleUploadedFile

from core.models import Musician, Band, Concert, Rehearsal, Performance, BandMembership

User = get_user_model()


class CustomAdminAccessTests(TestCase):
    
    def setUp(self):
        self.client = Client()
        

        self.regular_user = User.objects.create_user(
            username='regular',
            password='password123',
            is_staff=False
        )

        self.staff_user = User.objects.create_user(
            username='admin',
            password='admin123',
            is_staff=True
        )

        self.musician = Musician.objects.create(
            first_name='Иван',
            last_name='Петров',
            phone='+375291234567',
            instrument='guitar'
        )
        
        self.band = Band.objects.create(
            band_name='Test Band',
            genre='rock',
            founded_date='2020-01-01'
        )
        
        self.concert = Concert.objects.create(
            concert_title='Test Concert',
            venue_address='Test Address',
            concert_date='2025-01-01 20:00:00'
        )
        
        self.rehearsal = Rehearsal.objects.create(
            band=self.band,
            rehearsal_date='2025-01-01 18:00:00',
            duration_minutes=120,
            location='Test Studio'
        )
        
        self.membership = BandMembership.objects.create(
            band=self.band,
            musician=self.musician,
            join_date='2024-01-01'
        )
        
        self.performance = Performance.objects.create(
            concert=self.concert,
            band=self.band,
            performance_order=1
        )

    def test_dashboard_access_regular_user(self):
        self.client.login(username='regular', password='password123')
        response = self.client.get(reverse('custom_admin:dashboard'))
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, '/admin/login/?next=/admin-panel/')

    def test_dashboard_access_staff_user(self):
        self.client.login(username='admin', password='admin123')
        response = self.client.get(reverse('custom_admin:dashboard'))
        self.assertEqual(response.status_code, 200)
        self.assertTemplateUsed(response, 'custom_admin/dashboard.html')
        self.assertContains(response, 'Административная панель')
        self.assertContains(response, 'Музыканты')
        self.assertContains(response, str(Musician.objects.count()))
        self.assertContains(response, str(Band.objects.count()))

    def test_dashboard_context_data(self):
        self.client.login(username='admin', password='admin123')
        response = self.client.get(reverse('custom_admin:dashboard'))
        self.assertEqual(response.status_code, 200)
        self.assertIn('counts', response.context)
        
        counts = response.context['counts']
        self.assertEqual(counts['musicians'], 1)
        self.assertEqual(counts['bands'], 1)
        self.assertEqual(counts['concerts'], 1)
        self.assertEqual(counts['rehearsals'], 1)
        self.assertEqual(counts['memberships'], 1)
        self.assertEqual(counts['performances'], 1)


class MusicianViewsTests(TestCase):
    def setUp(self):
        self.client = Client()
        self.staff_user = User.objects.create_user(
            username='admin',
            password='admin123',
            is_staff=True
        )
        self.client.login(username='admin', password='admin123')
        
        self.musician_data = {
            'first_name': 'Алексей',
            'last_name': 'Смирнов',
            'phone': '+375292345678',
            'instrument': 'drums',
            'telegram': '@alex_sm'
        }
        
        self.musician = Musician.objects.create(**self.musician_data)

    def test_musician_list_view(self):
        response = self.client.get(reverse('custom_admin:musician_list'))
        self.assertEqual(response.status_code, 200)
        self.assertTemplateUsed(response, 'custom_admin/musicians/list.html')
        self.assertContains(response, 'Алексей')
        self.assertContains(response, 'Смирнов')
        self.assertContains(response, 'drums')

    def test_musician_create_view_get(self):
        response = self.client.get(reverse('custom_admin:musician_create'))
        self.assertEqual(response.status_code, 200)
        self.assertTemplateUsed(response, 'custom_admin/musicians/form.html')
        self.assertContains(response, 'Создать музыканта')

    def test_musician_create_view_post(self):
        new_musician = {
            'first_name': 'Мария',
            'last_name': 'Иванова',
            'phone': '+375293456789',
            'instrument': 'piano',
            'telegram': '@maria_ivanova'
        }
        
        response = self.client.post(
            reverse('custom_admin:musician_create'),
            new_musician
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, reverse('custom_admin:musician_list'))
        
        self.assertTrue(Musician.objects.filter(
            first_name='Мария',
            last_name='Иванова'
        ).exists())

    def test_musician_update_view_get(self):
        response = self.client.get(
            reverse('custom_admin:musician_update', args=[self.musician.pk])
        )
        self.assertEqual(response.status_code, 200)
        self.assertTemplateUsed(response, 'custom_admin/musicians/form.html')
        self.assertContains(response, 'Редактировать музыканта')
        self.assertContains(response, 'Алексей')

    def test_musician_update_view_post(self):
        """Тест: POST запрос на обновление музыканта"""
        updated_data = {
            'first_name': 'Александр',
            'last_name': 'Смирнов',
            'phone': '+375292345678',
            'instrument': 'bass',
            'telegram': '@alex_bass'
        }
        
        response = self.client.post(
            reverse('custom_admin:musician_update', args=[self.musician.pk]),
            updated_data
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, reverse('custom_admin:musician_list'))
        
        self.musician.refresh_from_db()
        self.assertEqual(self.musician.first_name, 'Александр')
        self.assertEqual(self.musician.instrument, 'bass')

    def test_musician_delete_view_get(self):
        response = self.client.get(
            reverse('custom_admin:musician_delete', args=[self.musician.pk])
        )
        self.assertEqual(response.status_code, 200)
        self.assertTemplateUsed(response, 'custom_admin/musicians/confirm_delete.html')
        self.assertContains(response, 'Подтверждение удаления')
        self.assertContains(response, 'Алексей')

    def test_musician_delete_view_post(self):
        response = self.client.post(
            reverse('custom_admin:musician_delete', args=[self.musician.pk])
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, reverse('custom_admin:musician_list'))
        
        self.assertFalse(Musician.objects.filter(pk=self.musician.pk).exists())


class BandViewsTests(TestCase):
    def setUp(self):
        self.client = Client()
        self.staff_user = User.objects.create_user(
            username='admin',
            password='admin123',
            is_staff=True
        )
        self.client.login(username='admin', password='admin123')
        
        self.band = Band.objects.create(
            band_name='Rock Stars',
            genre='rock',
            founded_date='2018-05-15'
        )
        
        self.musician = Musician.objects.create(
            first_name='Петр',
            last_name='Сидоров',
            phone='+375294567890',
            instrument='guitar'
        )

    def test_band_list_view(self):
        response = self.client.get(reverse('custom_admin:band_list'))
        self.assertEqual(response.status_code, 200)
        self.assertTemplateUsed(response, 'custom_admin/bands/list.html')
        self.assertContains(response, 'Rock Stars')
        self.assertContains(response, 'rock')

    def test_band_create_view_post_valid(self):
        new_band = {
            'band_name': 'Jazz Cats',
            'genre': 'jazz',
            'founded_date': '2020-03-20'
        }
        
        response = self.client.post(
            reverse('custom_admin:band_create'),
            new_band
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, reverse('custom_admin:band_list'))
        self.assertTrue(Band.objects.filter(band_name='Jazz Cats').exists())

    def test_band_create_view_post_invalid(self):
        invalid_band = {
            'band_name': '',
            'genre': 'jazz',
            'founded_date': '2020-03-20'
        }
        
        response = self.client.post(
            reverse('custom_admin:band_create'),
            invalid_band
        )
        
        self.assertEqual(response.status_code, 200)
        self.assertFormError(response, 'form', 'band_name', 'This field is required.')

    def test_band_update_view_post(self):
        updated_data = {
            'band_name': 'Rock Legends',
            'genre': 'hard_rock',
            'founded_date': '2018-05-15'
        }
        
        response = self.client.post(
            reverse('custom_admin:band_update', args=[self.band.pk]),
            updated_data
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, reverse('custom_admin:band_list'))
        
        self.band.refresh_from_db()
        self.assertEqual(self.band.band_name, 'Rock Legends')
        self.assertEqual(self.band.genre, 'hard_rock')

    def test_band_delete_view(self):
        response = self.client.post(
            reverse('custom_admin:band_delete', args=[self.band.pk])
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, reverse('custom_admin:band_list'))
        self.assertFalse(Band.objects.filter(pk=self.band.pk).exists())


class ConcertViewsTests(TestCase):
    def setUp(self):
        self.client = Client()
        self.staff_user = User.objects.create_user(
            username='admin',
            password='admin123',
            is_staff=True
        )
        self.client.login(username='admin', password='admin123')
        
        self.concert = Concert.objects.create(
            concert_title='Summer Festival',
            venue_address='Central Park',
            concert_date='2025-07-15 19:00:00'
        )

    def test_concert_list_view(self):
        response = self.client.get(reverse('custom_admin:concert_list'))
        self.assertEqual(response.status_code, 200)
        self.assertTemplateUsed(response, 'custom_admin/concerts/list.html')
        self.assertContains(response, 'Summer Festival')
        self.assertContains(response, 'Central Park')

    def test_concert_create_view_post(self):
        new_concert = {
            'concert_title': 'Winter Concert',
            'venue_address': 'City Hall',
            'concert_date': '2025-12-20 18:30:00'
        }
        
        response = self.client.post(
            reverse('custom_admin:concert_create'),
            new_concert
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, reverse('custom_admin:concert_list'))
        self.assertTrue(Concert.objects.filter(concert_title='Winter Concert').exists())

    def test_concert_update_view_post(self):
        updated_data = {
            'concert_title': 'Summer Music Festival',
            'venue_address': 'Central Park, Main Stage',
            'concert_date': '2025-07-15 19:00:00'
        }
        
        response = self.client.post(
            reverse('custom_admin:concert_update', args=[self.concert.pk]),
            updated_data
        )
        
        self.assertEqual(response.status_code, 302)
        self.concert.refresh_from_db()
        self.assertEqual(self.concert.concert_title, 'Summer Music Festival')
        self.assertEqual(self.concert.venue_address, 'Central Park, Main Stage')

    def test_concert_delete_view(self):
        """Тест: удаление концерта"""
        response = self.client.post(
            reverse('custom_admin:concert_delete', args=[self.concert.pk])
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertFalse(Concert.objects.filter(pk=self.concert.pk).exists())


class RehearsalViewsTests(TestCase):
    def setUp(self):
        self.client = Client()
        self.staff_user = User.objects.create_user(
            username='admin',
            password='admin123',
            is_staff=True
        )
        self.client.login(username='admin', password='admin123')
        
        self.band = Band.objects.create(
            band_name='Test Band',
            genre='pop'
        )
        
        self.rehearsal = Rehearsal.objects.create(
            band=self.band,
            rehearsal_date='2025-01-10 17:00:00',
            duration_minutes=90,
            location='Studio A'
        )

    def test_rehearsal_list_view(self):
        response = self.client.get(reverse('custom_admin:rehearsal_list'))
        self.assertEqual(response.status_code, 200)
        self.assertTemplateUsed(response, 'custom_admin/rehearsals/list.html')
        self.assertContains(response, 'Studio A')
        self.assertContains(response, '90 мин.')

    def test_rehearsal_create_view_post_valid(self):
        new_rehearsal = {
            'band': self.band.pk,
            'rehearsal_date': '2025-01-12 18:00:00',
            'duration_minutes': 120,
            'location': 'Studio B'
        }
        
        response = self.client.post(
            reverse('custom_admin:rehearsal_create'),
            new_rehearsal
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, reverse('custom_admin:rehearsal_list'))
        
        self.assertTrue(Rehearsal.objects.filter(
            location='Studio B',
            duration_minutes=120
        ).exists())

    def test_rehearsal_create_view_post_invalid_duration(self):
        invalid_rehearsal = {
            'band': self.band.pk,
            'rehearsal_date': '2025-01-12 18:00:00',
            'duration_minutes': 5,
            'location': 'Studio B'
        }
        
        response = self.client.post(
            reverse('custom_admin:rehearsal_create'),
            invalid_rehearsal
        )
        
        self.assertEqual(response.status_code, 200)
        self.assertFormError(
            response, 'form', 'duration_minutes',
            'Минимальная продолжительность репетиции - 15 минут'
        )

    def test_rehearsal_update_view_post(self):
        updated_data = {
            'band': self.band.pk,
            'rehearsal_date': '2025-01-10 18:00:00', 
            'duration_minutes': 120, 
            'location': 'Main Studio' 
        }
        
        response = self.client.post(
            reverse('custom_admin:rehearsal_update', args=[self.rehearsal.pk]),
            updated_data
        )
        
        self.assertEqual(response.status_code, 302)
        self.rehearsal.refresh_from_db()
        self.assertEqual(self.rehearsal.duration_minutes, 120)
        self.assertEqual(self.rehearsal.location, 'Main Studio')

    def test_rehearsal_delete_view(self):
        response = self.client.post(
            reverse('custom_admin:rehearsal_delete', args=[self.rehearsal.pk])
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertFalse(Rehearsal.objects.filter(pk=self.rehearsal.pk).exists())


class PerformanceViewsTests(TestCase):
    def setUp(self):
        self.client = Client()
        self.staff_user = User.objects.create_user(
            username='admin',
            password='admin123',
            is_staff=True
        )
        self.client.login(username='admin', password='admin123')
        
        self.band = Band.objects.create(
            band_name='Performance Band',
            genre='rock'
        )
        
        self.concert = Concert.objects.create(
            concert_title='Test Festival',
            venue_address='Test Venue'
        )
        
        self.performance = Performance.objects.create(
            concert=self.concert,
            band=self.band,
            performance_order=1
        )

    def test_performance_list_view(self):
        response = self.client.get(reverse('custom_admin:performance_list'))
        self.assertEqual(response.status_code, 200)
        self.assertTemplateUsed(response, 'custom_admin/performances/list.html')
        self.assertContains(response, 'Performance Band')
        self.assertContains(response, 'Test Festival')

    def test_performance_create_view_post(self):
        concert2 = Concert.objects.create(
            concert_title='Another Concert',
            venue_address='Another Venue'
        )
        
        band2 = Band.objects.create(
            band_name='Second Band',
            genre='jazz'
        )
        
        new_performance = {
            'concert': concert2.pk,
            'band': band2.pk,
            'performance_order': 2
        }
        
        response = self.client.post(
            reverse('custom_admin:performance_create'),
            new_performance
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, reverse('custom_admin:performance_list'))
        
        self.assertTrue(Performance.objects.filter(
            concert=concert2,
            band=band2,
            performance_order=2
        ).exists())

    def test_performance_update_view_post(self):
        new_band = Band.objects.create(
            band_name='Updated Band',
            genre='pop'
        )
        
        updated_data = {
            'concert': self.concert.pk,
            'band': new_band.pk,
            'performance_order': 3
        }
        
        response = self.client.post(
            reverse('custom_admin:performance_update', args=[self.performance.pk]),
            updated_data
        )
        
        self.assertEqual(response.status_code, 302)
        self.performance.refresh_from_db()
        self.assertEqual(self.performance.band, new_band)
        self.assertEqual(self.performance.performance_order, 3)

    def test_performance_delete_view(self):
        response = self.client.post(
            reverse('custom_admin:performance_delete', args=[self.performance.pk])
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertFalse(Performance.objects.filter(pk=self.performance.pk).exists())


class MembershipViewsTests(TestCase):
    def setUp(self):
        self.client = Client()
        self.staff_user = User.objects.create_user(
            username='admin',
            password='admin123',
            is_staff=True
        )
        self.client.login(username='admin', password='admin123')
        
        self.musician = Musician.objects.create(
            first_name='Иван',
            last_name='Членов',
            phone='+375295678901',
            instrument='bass'
        )
        
        self.band = Band.objects.create(
            band_name='Membership Test Band',
            genre='metal'
        )
        
        self.membership = BandMembership.objects.create(
            band=self.band,
            musician=self.musician,
            join_date='2024-02-01'
        )

    def test_membership_list_view(self):
        response = self.client.get(reverse('custom_admin:membership_list'))
        self.assertEqual(response.status_code, 200)
        self.assertTemplateUsed(response, 'custom_admin/membership/list.html')
        self.assertContains(response, 'Иван Членов')
        self.assertContains(response, 'Membership Test Band')

    def test_membership_create_view_post(self):
        new_musician = Musician.objects.create(
            first_name='Петр',
            last_name='Новый',
            phone='+375296789012',
            instrument='guitar'
        )
        
        new_membership = {
            'band': self.band.pk,
            'musician': new_musician.pk,
            'join_date': '2024-03-01'
        }
        
        response = self.client.post(
            reverse('custom_admin:membership_create'),
            new_membership
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, reverse('custom_admin:membership_list'))
        
        self.assertTrue(BandMembership.objects.filter(
            band=self.band,
            musician=new_musician
        ).exists())

    def test_membership_create_view_post_duplicate(self):
        duplicate_membership = {
            'band': self.band.pk,
            'musician': self.musician.pk,
            'join_date': '2024-03-01'
        }
        
        response = self.client.post(
            reverse('custom_admin:membership_create'),
            duplicate_membership
        )
        
        self.assertEqual(response.status_code, 200)
        self.assertFormError(
            response, 'form', '__all__',
            'Band membership with this Band and Musician already exists.'
        )

    def test_membership_update_view_post(self):
        """Тест: обновление членства"""
        updated_data = {
            'band': self.band.pk,
            'musician': self.musician.pk,
            'join_date': '2024-01-15'
        }
        
        response = self.client.post(
            reverse('custom_admin:membership_update', args=[self.membership.pk]),
            updated_data
        )
        
        self.assertEqual(response.status_code, 302)
        self.membership.refresh_from_db()
        self.assertEqual(str(self.membership.join_date), '2024-01-15')

    def test_membership_delete_view(self):
        response = self.client.post(
            reverse('custom_admin:membership_delete', args=[self.membership.pk])
        )
        
        self.assertEqual(response.status_code, 302)
        self.assertFalse(BandMembership.objects.filter(pk=self.membership.pk).exists())


class NavigationAndTemplateTests(TestCase):
    
    def setUp(self):
        self.client = Client()
        self.staff_user = User.objects.create_user(
            username='admin',
            password='admin123',
            is_staff=True
        )
        self.client.login(username='admin', password='admin123')
    
    def test_admin_base_template(self):
        response = self.client.get(reverse('custom_admin:dashboard'))
        self.assertEqual(response.status_code, 200)
        
        self.assertContains(response, 'Главная')
        self.assertContains(response, 'Музыканты')
        self.assertContains(response, 'Группы')
        self.assertContains(response, 'Концерты')
        self.assertContains(response, 'Выступления')
        self.assertContains(response, 'Репетиции')
        self.assertContains(response, 'Членства')
    
    def test_dashboard_template_content(self):
        response = self.client.get(reverse('custom_admin:dashboard'))
        
        self.assertContains(response, 'card text-bg-primary')
        self.assertContains(response, 'card text-bg-success')
        self.assertContains(response, 'card text-bg-warning')
        self.assertContains(response, 'card text-bg-info')
        self.assertContains(response, 'card text-bg-secondary')
        self.assertContains(response, 'card text-bg-dark')
        
        self.assertContains(response, 'Новый музыкант')
        self.assertContains(response, 'Новая группа')
        self.assertContains(response, 'Новый концерт')
        self.assertContains(response, 'Новое выступление')
        self.assertContains(response, 'Новая репетиция')
        self.assertContains(response, 'Новое членство')
    
    def test_form_templates_have_required_fields(self):
        urls_to_test = [
            ('custom_admin:musician_create', 'first_name'),
            ('custom_admin:band_create', 'band_name'),
            ('custom_admin:concert_create', 'concert_title'),
            ('custom_admin:rehearsal_create', 'location'),
        ]
        
        for url_name, field_name in urls_to_test:
            response = self.client.get(reverse(url_name))
            self.assertEqual(response.status_code, 200)
            self.assertContains(response, field_name)
            self.assertContains(response, 'required')


class ErrorHandlingTests(TestCase):
    def setUp(self):
        self.client = Client()
        self.staff_user = User.objects.create_user(
            username='admin',
            password='admin123',
            is_staff=True
        )
        self.client.login(username='admin', password='admin123')
    
    def test_nonexistent_object_update(self):
        """Тест: попытка редактирования несуществующего объекта"""
        response = self.client.get(reverse('custom_admin:musician_update', args=[9999]))
        self.assertEqual(response.status_code, 404)
    
    def test_nonexistent_object_delete(self):
        """Тест: попытка удаления несуществующего объекта"""
        response = self.client.post(reverse('custom_admin:band_delete', args=[9999]))
        self.assertEqual(response.status_code, 404)
    
    def test_invalid_post_data(self):
        """Тест: отправка невалидных данных в форму"""
        invalid_data = {
            'band_name': '',
            'genre': 'rock',
            'founded_date': 'invalid_date'
        }
        
        response = self.client.post(
            reverse('custom_admin:band_create'),
            invalid_data
        )
        
        self.assertEqual(response.status_code, 200)
        self.assertFormError(response, 'form', 'band_name', 'This field is required.')
        self.assertFormError(response, 'form', 'founded_date', 'Enter a valid date.')


class MessageDisplayTests(TestCase):
    
    def setUp(self):
        self.client = Client()
        self.staff_user = User.objects.create_user(
            username='admin',
            password='admin123',
            is_staff=True
        )
        self.client.login(username='admin', password='admin123')
        
        self.musician = Musician.objects.create(
            first_name='Test',
            last_name='Musician',
            phone='+375290000000',
            instrument='guitar'
        )
    
    def test_success_message_on_create(self):
        new_musician = {
            'first_name': 'New',
            'last_name': 'Musician',
            'phone': '+375291111111',
            'instrument': 'piano'
        }
        
        response = self.client.post(
            reverse('custom_admin:musician_create'),
            new_musician,
            follow=True
        )
        
        messages_list = list(response.context['messages'])
        self.assertEqual(len(messages_list), 1)
        self.assertEqual(str(messages_list[0]), 'Музыкант успешно создан!')
        self.assertEqual(messages_list[0].tags, 'success')
    
    def test_success_message_on_update(self):
        """Тест: сообщение об успешном обновлении"""
        updated_data = {
            'first_name': 'Updated',
            'last_name': 'Musician',
            'phone': '+375290000000',
            'instrument': 'bass'
        }
        
        response = self.client.post(
            reverse('custom_admin:musician_update', args=[self.musician.pk]),
            updated_data,
            follow=True
        )
        
        messages_list = list(response.context['messages'])
        self.assertEqual(len(messages_list), 1)
        self.assertEqual(str(messages_list[0]), 'Музыкант успешно обновлен!')
        self.assertEqual(messages_list[0].tags, 'success')
    
    def test_success_message_on_delete(self):
        response = self.client.post(
            reverse('custom_admin:musician_delete', args=[self.musician.pk]),
            follow=True
        )
        
        messages_list = list(response.context['messages'])
        self.assertEqual(len(messages_list), 1)
        self.assertEqual(str(messages_list[0]), 'Музыкант удален!')
        self.assertEqual(messages_list[0].tags, 'success')
```

`custom_admin/urls.py`:

```py
from django.urls import path
from . import views

app_name = 'custom_admin'

urlpatterns = [
    path('', views.admin_dashboard, name='dashboard'),

    path('musicians/', views.musician_list, name='musician_list'),
    path('musicians/create/', views.musician_create, name='musician_create'),
    path('musicians/<int:pk>/edit/', views.musician_update, name='musician_update'),
    path('musicians/<int:pk>/delete/', views.musician_delete, name='musician_delete'),

    path('bands/', views.band_list, name='band_list'),
    path('bands/create/', views.band_create, name='band_create'),
    path('bands/<int:pk>/edit/', views.band_update, name='band_update'),
    path('bands/<int:pk>/delete/', views.band_delete, name='band_delete'),

    path('concerts/', views.concert_list, name='concert_list'),
    path('concerts/create/', views.concert_create, name='concert_create'),
    path('concerts/<int:pk>/edit/', views.concert_update, name='concert_update'),
    path('concerts/<int:pk>/delete/', views.concert_delete, name='concert_delete'),

    path('rehearsals/', views.rehearsal_list, name='rehearsal_list'),
    path('rehearsals/create/', views.rehearsal_create, name='rehearsal_create'),
    path('rehearsals/<int:pk>/edit/', views.rehearsal_update, name='rehearsal_update'),
    path('rehearsals/<int:pk>/delete/', views.rehearsal_delete, name='rehearsal_delete'),

    path('memberships/', views.membership_list, name='membership_list'),
    path('memberships/create/', views.membership_create, name='membership_create'),
    path('memberships/<int:pk>/edit/', views.membership_update, name='membership_update'),
    path('memberships/<int:pk>/delete/', views.membership_delete, name='membership_delete'),

    path('performances/', views.performance_list, name='performance_list'),
    path('performances/create/', views.performance_create, name='performance_create'),
    path('performances/<int:pk>/edit/', views.performance_update, name='performance_update'),
    path('performances/<int:pk>/delete/', views.performance_delete, name='performance_delete'),
]
```

`custom_admin/views.py`:

```py
from django.shortcuts import render, redirect, get_object_or_404
from django.contrib.auth.decorators import user_passes_test
from django.contrib import messages

from core.models import Musician, Band, Concert, Rehearsal, BandMembership, Performance
from custom_admin.forms import (
    MusicianForm, BandForm, ConcertForm, BandMembershipForm,
    RehearsalForm, PerformanceForm
)


def staff_required(user):
    return user.is_staff


@user_passes_test(staff_required)
def admin_dashboard(request):
    counts = {
        'musicians': Musician.objects.count(),
        'bands': Band.objects.count(),
        'concerts': Concert.objects.count(),
        'rehearsals': Rehearsal.objects.count(),
        'memberships': BandMembership.objects.count(),
        'performances': Performance.objects.count(),
    }
    return render(request, 'custom_admin/dashboard.html', {'counts': counts})


@user_passes_test(staff_required)
def musician_list(request):
    musicians = Musician.objects.all().order_by('last_name', 'first_name')
    return render(request, 'custom_admin/musicians/list.html', {'musicians': musicians})


@user_passes_test(staff_required)
def musician_create(request):
    if request.method == 'POST':
        form = MusicianForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, 'Музыкант успешно создан!')
            return redirect('custom_admin:musician_list')
    else:
        form = MusicianForm()
    return render(request, 'custom_admin/musicians/form.html', {
        'form': form,
        'title': 'Создать музыканта'
    })


@user_passes_test(staff_required)
def musician_update(request, pk):
    musician = get_object_or_404(Musician, pk=pk)
    if request.method == 'POST':
        form = MusicianForm(request.POST, instance=musician)
        if form.is_valid():
            form.save()
            messages.success(request, 'Музыкант успешно обновлен!')
            return redirect('custom_admin:musician_list')
    else:
        form = MusicianForm(instance=musician)
    return render(request, 'custom_admin/musicians/form.html', {
        'form': form,
        'title': 'Редактировать музыканта'
    })


@user_passes_test(staff_required)
def musician_delete(request, pk):
    musician = get_object_or_404(Musician, pk=pk)
    if request.method == 'POST':
        musician.delete()
        messages.success(request, 'Музыкант удален!')
        return redirect('custom_admin:musician_list')
    return render(request, 'custom_admin/musicians/confirm_delete.html', {'object': musician})


@user_passes_test(staff_required)
def band_list(request):
    bands = Band.objects.all().order_by('band_name')
    return render(request, 'custom_admin/bands/list.html', {'bands': bands})


@user_passes_test(staff_required)
def band_create(request):
    if request.method == 'POST':
        form = BandForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, 'Группа успешно создана!')
            return redirect('custom_admin:band_list')
    else:
        form = BandForm()
    return render(request, 'custom_admin/bands/form.html', {
        'form': form,
        'title': 'Создать группу'
    })


@user_passes_test(staff_required)
def band_update(request, pk):
    band = get_object_or_404(Band, pk=pk)
    if request.method == 'POST':
        form = BandForm(request.POST, instance=band)
        if form.is_valid():
            form.save()
            messages.success(request, 'Группа успешно обновлена!')
            return redirect('custom_admin:band_list')
    else:
        form = BandForm(instance=band)
    return render(request, 'custom_admin/bands/form.html', {
        'form': form,
        'title': 'Редактировать группу'
    })


@user_passes_test(staff_required)
def band_delete(request, pk):
    band = get_object_or_404(Band, pk=pk)
    if request.method == 'POST':
        band.delete()
        messages.success(request, 'Группа удалена!')
        return redirect('custom_admin:band_list')
    return render(request, 'custom_admin/bands/confirm_delete.html', {'object': band})


@user_passes_test(staff_required)
def concert_list(request):
    concerts = Concert.objects.all().order_by('-concert_date')
    return render(request, 'custom_admin/concerts/list.html', {'concerts': concerts})


@user_passes_test(staff_required)
def concert_create(request):
    if request.method == 'POST':
        form = ConcertForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, 'Концерт успешно создан!')
            return redirect('custom_admin:concert_list')
    else:
        form = ConcertForm()
    return render(request, 'custom_admin/concerts/form.html', {
        'form': form,
        'title': 'Создать концерт'
    })


@user_passes_test(staff_required)
def concert_update(request, pk):
    concert = get_object_or_404(Concert, pk=pk)
    if request.method == 'POST':
        form = ConcertForm(request.POST, instance=concert)
        if form.is_valid():
            form.save()
            messages.success(request, 'Концерт успешно обновлен!')
            return redirect('custom_admin:concert_list')
    else:
        form = ConcertForm(instance=concert)
    return render(request, 'custom_admin/concerts/form.html', {
        'form': form,
        'title': 'Редактировать концерт'
    })


@user_passes_test(staff_required)
def concert_delete(request, pk):
    concert = get_object_or_404(Concert, pk=pk)
    if request.method == 'POST':
        concert.delete()
        messages.success(request, 'Концерт удален!')
        return redirect('custom_admin:concert_list')
    return render(request, 'custom_admin/concerts/confirm_delete.html', {'object': concert})


@user_passes_test(staff_required)
def rehearsal_list(request):
    rehearsals = Rehearsal.objects.select_related('band').order_by('-rehearsal_date')
    return render(request, 'custom_admin/rehearsals/list.html', {'rehearsals': rehearsals})


@user_passes_test(staff_required)
def rehearsal_create(request):
    if request.method == 'POST':
        form = RehearsalForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, 'Репетиция успешно создана!')
            return redirect('custom_admin:rehearsal_list')
    else:
        form = RehearsalForm()
    return render(request, 'custom_admin/rehearsals/form.html', {
        'form': form,
        'title': 'Создать репетицию'
    })


@user_passes_test(staff_required)
def rehearsal_update(request, pk):
    rehearsal = get_object_or_404(Rehearsal, pk=pk)
    if request.method == 'POST':
        form = RehearsalForm(request.POST, instance=rehearsal)
        if form.is_valid():
            form.save()
            messages.success(request, 'Репетиция успешно обновлена!')
            return redirect('custom_admin:rehearsal_list')
    else:
        form = RehearsalForm(instance=rehearsal)
    return render(request, 'custom_admin/rehearsals/form.html', {
        'form': form,
        'title': 'Редактировать репетицию'
    })


@user_passes_test(staff_required)
def rehearsal_delete(request, pk):
    rehearsal = get_object_or_404(Rehearsal, pk=pk)
    if request.method == 'POST':
        rehearsal.delete()
        messages.success(request, 'Репетиция удалена!')
        return redirect('custom_admin:rehearsal_list')
    return render(request, 'custom_admin/rehearsals/confirm_delete.html', {'object': rehearsal})


@user_passes_test(staff_required)
def membership_list(request):
    memberships = BandMembership.objects.select_related('musician', 'band').order_by('-join_date')
    return render(request, 'custom_admin/membership/list.html', {'memberships': memberships})


@user_passes_test(staff_required)
def membership_create(request):
    if request.method == 'POST':
        form = BandMembershipForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, 'Членство успешно создано!')
            return redirect('custom_admin:membership_list')
    else:
        form = BandMembershipForm()
    return render(request, 'custom_admin/membership/form.html', {
        'form': form,
        'title': 'Создать членство'
    })


@user_passes_test(staff_required)
def membership_update(request, pk):
    membership = get_object_or_404(BandMembership, pk=pk)
    if request.method == 'POST':
        form = BandMembershipForm(request.POST, instance=membership)
        if form.is_valid():
            form.save()
            messages.success(request, 'Членство успешно обновлено!')
            return redirect('custom_admin:membership_list')
    else:
        form = BandMembershipForm(instance=membership)
    return render(request, 'custom_admin/membership/form.html', {
        'form': form,
        'title': 'Редактировать членство'
    })


@user_passes_test(staff_required)
def membership_delete(request, pk):
    membership = get_object_or_404(BandMembership, pk=pk)
    if request.method == 'POST':
        membership.delete()
        messages.success(request, 'Членство удалено!')
        return redirect('custom_admin:membership_list')
    return render(request, 'custom_admin/membership/confirm_delete.html', {'object': membership})


@user_passes_test(staff_required)
def performance_list(request):
    performances = Performance.objects.select_related('concert', 'band').order_by('concert__concert_date', 'performance_order')
    return render(request, 'custom_admin/performances/list.html', {'performances': performances})


@user_passes_test(staff_required)
def performance_create(request):
    if request.method == 'POST':
        form = PerformanceForm(request.POST)
        if form.is_valid():
            form.save()
            messages.success(request, 'Выступление успешно создано!')
            return redirect('custom_admin:performance_list')
    else:
        form = PerformanceForm()
    return render(request, 'custom_admin/performances/form.html', {
        'form': form,
        'title': 'Создать выступление'
    })


@user_passes_test(staff_required)
def performance_update(request, pk):
    performance = get_object_or_404(Performance, pk=pk)
    if request.method == 'POST':
        form = PerformanceForm(request.POST, instance=performance)
        if form.is_valid():
            form.save()
            messages.success(request, 'Выступление успешно обновлено!')
            return redirect('custom_admin:performance_list')
    else:
        form = PerformanceForm(instance=performance)
    return render(request, 'custom_admin/performances/form.html', {
        'form': form,
        'title': 'Редактировать выступление'
    })


@user_passes_test(staff_required)
def performance_delete(request, pk):
    performance = get_object_or_404(Performance, pk=pk)
    if request.method == 'POST':
        performance.delete()
        messages.success(request, 'Выступление удалено!')
        return redirect('custom_admin:performance_list')
    return render(request, 'custom_admin/performances/confirm_delete.html', {'object': performance})
```

`docker-compose.yml`:

```yml
services:
  db:
    image: postgres:15
    environment:
      POSTGRES_DB: concerts_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5433:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  web:
    build: .
    volumes:
      - .:/app
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgres://postgres:postgres@db:5432/concerts_db
      - SECRET_KEY=django-insecure-test-key-12345
      - DEBUG=1
    depends_on:
      db:
        condition: service_healthy

volumes:
  postgres_data:
```

`for_authorization/admin.py`:

```py
from django.contrib import admin

```

`for_authorization/apps.py`:

```py
from django.apps import AppConfig


class ForAuthorizationConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'for_authorization'
    verbose_name = 'Авторизация'
```

`for_authorization/forms.py`:

```py
from django import forms
from django.contrib.auth.forms import AuthenticationForm, PasswordChangeForm, UserCreationForm
from django.core.exceptions import ValidationError
from .models import MusicianUser

class MusicianAuthenticationForm(AuthenticationForm):
    username = forms.CharField(
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Имя пользователя'}),
        label='Имя пользователя'
    )
    
    password = forms.CharField(
        widget=forms.PasswordInput(attrs={'class': 'form-control', 'placeholder': 'Пароль'}),
        label='Пароль'
    )

class MusicianUserCreationForm(UserCreationForm):
    email = forms.EmailField(
        required=True,
        widget=forms.EmailInput(attrs={'class': 'form-control', 'placeholder': 'Email'})
    )
    
    phone = forms.CharField(
        required=False,
        max_length=20,
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Телефон'})
    )
    
    instrument = forms.CharField(
        required=False,
        max_length=50,
        widget=forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Инструмент'})
    )
    
    class Meta:
        model = MusicianUser
        fields = ('username', 'email', 'password1', 'password2', 'phone', 'instrument')
        widgets = {
            'username': forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Имя пользователя'}),
        }
    
    def save(self, commit=True):
        user = super().save(commit=False)
        user.email = self.cleaned_data['email']
        user.phone = self.cleaned_data.get('phone', '')
        user.instrument = self.cleaned_data.get('instrument', '')
        
        if commit:
            user.save()
        
        return user

class MusicianUserUpdateForm(forms.ModelForm):
    class Meta:
        model = MusicianUser
        fields = ('username', 'email', 'first_name', 'last_name', 'phone', 'instrument', 'bio')
        widgets = {
            'username': forms.TextInput(attrs={'class': 'form-control'}),
            'email': forms.EmailInput(attrs={'class': 'form-control'}),
            'first_name': forms.TextInput(attrs={'class': 'form-control'}),
            'last_name': forms.TextInput(attrs={'class': 'form-control'}),
            'phone': forms.TextInput(attrs={'class': 'form-control'}),
            'instrument': forms.TextInput(attrs={'class': 'form-control'}),
            'bio': forms.Textarea(attrs={'class': 'form-control', 'rows': 3}),
        }
```

`for_authorization/migrations/0001_initial.py`:

```py
# Generated by Django 5.2.9 on 2025-12-16 20:28

import django.contrib.auth.models
import django.contrib.auth.validators
import django.utils.timezone
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='MusicianUser',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('username', models.CharField(error_messages={'unique': 'A user with that username already exists.'}, help_text='Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.', max_length=150, unique=True, validators=[django.contrib.auth.validators.UnicodeUsernameValidator()], verbose_name='username')),
                ('first_name', models.CharField(blank=True, max_length=150, verbose_name='first name')),
                ('last_name', models.CharField(blank=True, max_length=150, verbose_name='last name')),
                ('email', models.EmailField(blank=True, max_length=254, verbose_name='email address')),
                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into this admin site.', verbose_name='staff status')),
                ('is_active', models.BooleanField(default=True, help_text='Designates whether this user should be treated as active. Unselect this instead of deleting accounts.', verbose_name='active')),
                ('date_joined', models.DateTimeField(default=django.utils.timezone.now, verbose_name='date joined')),
                ('phone', models.CharField(blank=True, max_length=20, null=True, verbose_name='Телефон')),
                ('telegram', models.CharField(blank=True, max_length=100, null=True, verbose_name='Telegram')),
                ('instrument', models.CharField(blank=True, max_length=50, null=True, verbose_name='Инструмент')),
                ('bio', models.TextField(blank=True, null=True, verbose_name='О себе')),
                ('groups', models.ManyToManyField(blank=True, help_text='The groups this user belongs to.', related_name='musicianuser_set', related_query_name='musicianuser', to='auth.group', verbose_name='groups')),
                ('user_permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='musicianuser_set', related_query_name='musicianuser', to='auth.permission', verbose_name='user permissions')),
            ],
            options={
                'verbose_name': 'Пользователь-музыкант',
                'verbose_name_plural': 'Пользователи-музыканты',
            },
            managers=[
                ('objects', django.contrib.auth.models.UserManager()),
            ],
        ),
    ]

```

`for_authorization/models.py`:

```py
from django.db import models
from django.contrib.auth.models import AbstractUser, Group, Permission
from django.utils.translation import gettext_lazy as _

class MusicianUser(AbstractUser):
    
    groups = models.ManyToManyField(
        Group,
        verbose_name=_('groups'),
        blank=True,
        help_text=_('The groups this user belongs to.'),
        related_name="musicianuser_set",
        related_query_name="musicianuser",
    )
    
    user_permissions = models.ManyToManyField(
        Permission,
        verbose_name=_('user permissions'),
        blank=True,
        help_text=_('Specific permissions for this user.'),
        related_name="musicianuser_set",
        related_query_name="musicianuser",
    )
    phone = models.CharField(
        max_length=20, 
        blank=True, 
        null=True,
        verbose_name=_('Телефон')
    )
    
    telegram = models.CharField(
        max_length=100, 
        blank=True, 
        null=True,
        verbose_name=_('Telegram')
    )
    
    instrument = models.CharField(
        max_length=50, 
        blank=True, 
        null=True,
        verbose_name=_('Инструмент')
    )
    
    bio = models.TextField(
        blank=True,
        null=True,
        verbose_name=_('О себе')
    )

    ROLE_CHOICES = (
        ('musician', 'Musician'),
        ('admin', 'Admin'),
    )
    role = models.CharField(
        max_length=20, 
        choices=ROLE_CHOICES, 
        default='musician'
    )
    
    class Meta:
        verbose_name = _('Пользователь-музыкант')
        verbose_name_plural = _('Пользователи-музыканты')
    
    def __str__(self):
        return self.username
```

`for_authorization/templates/core/home.html`:

```html
{% extends 'base.html' %}

{% block title %}Главная страница{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card bg-dark text-white">
            <div class="card-body p-5">
                <div class="text-center mb-5">
                    <h1 class="display-4 fw-bold mb-3">🎵 Добро пожаловать в Music Manager!</h1>
                    <p class="lead">Система управления музыкальными группами, репетициями и концертами.</p>
                </div>

                {% if not user.is_authenticated %}
                <div class="text-center mt-5">
                    <h3 class="mb-4">Начните прямо сейчас</h3>
                    <p class="mb-4">Зарегистрируйтесь, чтобы получить доступ ко всем функциям:</p>
                    
                    <div class="d-flex justify-content-center gap-3">
                        <a href="{% url 'register' %}" class="btn btn-primary btn-lg px-5 py-3">
                            <i class="bi bi-person-plus"></i> Регистрация
                        </a>
                        <a href="{% url 'login' %}" class="btn btn-outline-light btn-lg px-5 py-3">
                            <i class="bi bi-box-arrow-in-right"></i> Войти
                        </a>
                    </div>
                </div>
                {% else %}
                <div class="text-center mt-5">
                    <h3 class="mb-4">Привет, {{ user.first_name|default:user.username }}! 👋</h3>
                    <p class="mb-4">Вы вошли в систему как <strong>{{ user.username }}</strong>.</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 bg-secondary text-white">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="bi bi-people-fill"></i> Мои группы</h5>
                                    <p class="card-text">Управляйте вашими музыкальными группами</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 bg-secondary text-white">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="bi bi-calendar-check"></i> Репетиции</h5>
                                    <p class="card-text">Планируйте и отслеживайте репетиции</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 bg-secondary text-white">
                                <div class="card-body">
                                    <h5 class="card-title"><i class="bi bi-megaphone-fill"></i> Концерты</h5>
                                    <p class="card-text">Организуйте выступления и концерты</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <a href="{% url 'profile' %}" class="btn btn-primary">
                            <i class="bi bi-person-circle"></i> Перейти в профиль
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`for_authorization/templates/core/profile/password_change.html`:

```html
{% extends 'base.html' %}

{% block title %}Смена пароля - Encore{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h4 class="mb-0"><i class="bi bi-key"></i> Смена пароля</h4>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                    <div class="alert alert-danger">
                        {% for field, errors in form.errors.items %}
                            {% for error in errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="mb-3">
                        <label class="form-label">Старый пароль *</label>
                        {{ form.old_password }}
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Новый пароль *</label>
                        {{ form.new_password1 }}
                        <small class="text-muted">{{ form.new_password1.help_text }}</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Подтверждение пароля *</label>
                        {{ form.new_password2 }}
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <button type="submit" class="btn btn-warning">
                            <i class="bi bi-check-circle"></i> Изменить пароль
                        </button>
                        <a href="{% url 'profile' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle"></i> Отмена
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`for_authorization/templates/core/profile/profile.html`:

```html
{% extends 'base.html' %}

{% block title %}Мой профиль - Encore{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="bi bi-person-circle"></i> Мой профиль</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 text-center mb-4">
                        <div class="mb-3">
                            <i class="bi bi-person-badge display-1 text-primary"></i>
                        </div>
                        <h5>{{ user_profile.username }}</h5>
                        {% if user_profile.first_name and user_profile.last_name %}
                        <p class="text-muted">{{ user_profile.first_name }} {{ user_profile.last_name }}</p>
                        {% endif %}
                    </div>
                    <div class="col-md-8">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <strong><i class="bi bi-envelope"></i> Email:</strong>
                                <p>{{ user_profile.email }}</p>
                            </div>
                            <div class="col-md-6">
                                <strong><i class="bi bi-telephone"></i> Телефон:</strong>
                                <p>{{ user_profile.phone|default:"Не указан" }}</p>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <strong><i class="bi bi-music-note"></i> Инструмент:</strong>
                                <p>{{ user_profile.instrument|default:"Не указан" }}</p>
                            </div>
                            <div class="col-md-6">
                                <strong><i class="bi bi-telegram"></i> Telegram:</strong>
                                <p>{{ user_profile.telegram|default:"Не указан" }}</p>
                            </div>
                        </div>
                        
                        {% if user_profile.bio %}
                        <div class="mb-3">
                            <strong><i class="bi bi-file-text"></i> О себе:</strong>
                            <p>{{ user_profile.bio }}</p>
                        </div>
                        {% endif %}
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <strong><i class="bi bi-calendar"></i> Дата регистрации:</strong>
                                <p>{{ user_profile.date_joined|date:"d.m.Y" }}</p>
                            </div>
                            <div class="col-md-6">
                                <strong><i class="bi bi-clock-history"></i> Последний вход:</strong>
                                <p>{{ user_profile.last_login|date:"d.m.Y H:i" }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr>
                
                <div class="d-flex justify-content-between">
                    <a href="{% url 'profile_edit' %}" class="btn btn-primary">
                        <i class="bi bi-pencil"></i> Редактировать профиль
                    </a>
                    <a href="{% url 'change_password' %}" class="btn btn-warning">
                        <i class="bi bi-key"></i> Сменить пароль
                    </a>
                    <a href="{% url 'home' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-house"></i> На главную
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`for_authorization/templates/core/profile/profile_edit.html`:

```html
{% extends 'base.html' %}

{% block title %}Редактирование профиля - Encore{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="bi bi-pencil-square"></i> Редактирование профиля</h4>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Имя пользователя *</label>
                            {{ form.username }}
                            {% if form.username.errors %}
                            <div class="text-danger">{{ form.username.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email *</label>
                            {{ form.email }}
                            {% if form.email.errors %}
                            <div class="text-danger">{{ form.email.errors }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Имя</label>
                            {{ form.first_name }}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Фамилия</label>
                            {{ form.last_name }}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Телефон</label>
                            {{ form.phone }}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Инструмент</label>
                            {{ form.instrument }}
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Сохранить изменения
                        </button>
                        <a href="{% url 'profile' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle"></i> Отмена
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`for_authorization/templates/core/registration/login.html`:

```html
{% extends 'base.html' %}

{% block title %}Вход в систему{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-5">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0"><i class="bi bi-box-arrow-in-right"></i> Вход в систему</h4>
            </div>
            <div class="card-body">
                {% if form.errors %}
                <div class="alert alert-danger">
                    Неверное имя пользователя или пароль.
                </div>
                {% endif %}

                {% if messages %}
                    {% for message in messages %}
                        {% if message.tags == 'error' %}
                        <div class="alert alert-danger">{{ message }}</div>
                        {% endif %}
                    {% endfor %}
                {% endif %}
                
                <form method="post">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label for="id_username" class="form-label">Имя пользователя</label>
                        <input type="text" name="username" id="id_username" 
                               class="form-control" required autofocus>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_password" class="form-label">Пароль</label>
                        <input type="password" name="password" id="id_password" 
                               class="form-control" required>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="bi bi-box-arrow-in-right"></i> Войти
                        </button>
                    </div>
                </form>
                
                <hr class="my-4">
                
                <div class="text-center">
                    <p class="mb-2">
                        <a href="{% url 'password_reset' %}">Забыли пароль?</a>
                    </p>
                    <p>
                        Нет аккаунта? <a href="{% url 'register' %}">Зарегистрируйтесь</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`for_authorization/templates/core/registration/password_reset.html`:

```html
{% extends 'base.html' %}

{% block title %}Восстановление пароля{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h4 class="mb-0"><i class="bi bi-key"></i> Восстановление пароля</h4>
            </div>
            <div class="card-body">
                <p class="mb-4">Введите ваш email, и мы вышлем инструкции для восстановления пароля.</p>
                
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="id_email" class="form-label">Email</label>
                        <input type="email" name="email" id="id_email" class="form-control" required>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-warning btn-lg">
                            <i class="bi bi-envelope"></i> Отправить инструкции
                        </button>
                    </div>
                </form>
                
                <hr class="my-4">
                
                <div class="text-center">
                    <p>
                        <a href="{% url 'login' %}">Вернуться к входу</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

```

`for_authorization/templates/core/registration/password_reset_complete.html`:

```html
{% extends 'base.html' %}

{% block title %}Пароль изменен{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0"><i class="bi bi-check-circle-fill"></i> Пароль изменен</h4>
            </div>
            <div class="card-body text-center">
                <div class="mb-4">
                    <i class="bi bi-shield-check display-1 text-success"></i>
                </div>
                
                <h5 class="mb-3">Пароль успешно изменен!</h5>
                <p class="mb-4">
                    Ваш пароль был успешно изменен. Теперь вы можете войти в систему с новым паролем.
                </p>
                
                <hr class="my-4">
                
                <div class="d-grid">
                    <a href="{% url 'login' %}" class="btn btn-success btn-lg">
                        <i class="bi bi-box-arrow-in-right"></i> Войти в систему
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

```

`for_authorization/templates/core/registration/password_reset_confirm.html`:

```html
{% extends 'base.html' %}

{% block title %}Введите новый пароль{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="bi bi-lock"></i> Введите новый пароль</h4>
            </div>
            <div class="card-body">
                <p class="mb-4">Пожалуйста, введите новый пароль дважды.</p>
                
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="id_new_password1" class="form-label">Новый пароль</label>
                        <input type="password" name="new_password1" id="id_new_password1" class="form-control" required>
                        <small class="text-muted">Минимум 8 символов</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_new_password2" class="form-label">Подтвердите пароль</label>
                        <input type="password" name="new_password2" id="id_new_password2" class="form-control" required>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-check-circle"></i> Изменить пароль
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

```

`for_authorization/templates/core/registration/password_reset_done.html`:

```html
{% extends 'base.html' %}

{% block title %}Письмо отправлено{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0"><i class="bi bi-check-circle"></i> Письмо отправлено</h4>
            </div>
            <div class="card-body text-center">
                <div class="mb-4">
                    <i class="bi bi-envelope-check display-1 text-info"></i>
                </div>
                
                <h5 class="mb-3">Проверьте вашу почту!</h5>
                <p class="mb-4">
                    Мы отправили вам инструкции по восстановлению пароля на указанный email.
                    Вы должны получить письмо в ближайшее время.
                </p>
                
                <div class="alert alert-info">
                    <small>
                        Если вы не получили письмо, пожалуйста, убедитесь что вы ввели правильный email,
                        и проверьте папку 'Спам'.
                    </small>
                </div>
                
                <hr class="my-4">
                
                <div class="text-center">
                    <a href="{% url 'login' %}" class="btn btn-primary">
                        <i class="bi bi-box-arrow-in-right"></i> Вернуться к входу
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

```

`for_authorization/templates/core/registration/register.html`:

```html
{% extends 'base.html' %}

{% block title %}Регистрация{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="bi bi-person-plus"></i> Регистрация</h4>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Используем правильные имена полей -->
                    <div class="mb-3">
                        <label class="form-label">Имя пользователя *</label>
                        <input type="text" name="username" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Email *</label>
                        <input type="email" name="email" class="form-control" required>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Имя</label>
                            <input type="text" name="first_name" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Фамилия</label>
                            <input type="text" name="last_name" class="form-control">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Телефон</label>
                            <input type="text" name="phone" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Инструмент</label>
                            <input type="text" name="instrument" class="form-control">
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Пароль *</label>
                            <input type="password" name="password1" class="form-control" required>
                            <small class="text-muted">Минимум 8 символов</small>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Подтверждение пароля *</label>
                            <input type="password" name="password2" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="bi bi-person-plus"></i> Зарегистрироваться
                        </button>
                    </div>
                </form>
                
                <hr class="my-4">
                
                <div class="text-center">
                    <p>Уже есть аккаунт? <a href="{% url 'login' %}">Войдите</a></p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`for_authorization/tests.py`:

```py
from django.test import TestCase, Client
from django.urls import reverse
from django.contrib.auth import get_user_model
from django.contrib.messages import get_messages

User = get_user_model()


class AuthenticationTests(TestCase):
    def setUp(self):
        self.client = Client()
        self.user_data = {
            'username': 'testuser',
            'email': 'test@example.com',
            'password': 'testpass123',
            'phone': '+375291234567',
            'instrument': 'guitar'
        }
    
    def test_home_page(self):
        response = self.client.get(reverse('home'))
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, 'Music Manager')
    
    def test_login_page(self):
        response = self.client.get(reverse('login'))
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, 'Вход в систему')
    
    def test_register_page(self):
        response = self.client.get(reverse('register'))
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, 'Регистрация')
    
    def test_user_registration(self):
        response = self.client.post(reverse('register'), {
            'username': 'newuser',
            'email': 'new@example.com',
            'password1': 'testpass123',
            'password2': 'testpass123',
            'phone': '+375291111111',
            'instrument': 'piano'
        })
        
        if response.status_code == 200:
            print("Form errors:", response.context['form'].errors if 'form' in response.context else 'No form in context')
        else:
            self.assertEqual(response.status_code, 302)

        self.assertTrue(User.objects.filter(username='newuser').exists())
    
    def test_login_logout(self):
        user = User.objects.create_user(
            username='testlogin',
            password='testpass123'
        )
        
        response = self.client.post(reverse('login'), {
            'username': 'testlogin',
            'password': 'testpass123'
        })
        self.assertEqual(response.status_code, 302)

        self.assertTrue('_auth_user_id' in self.client.session)

        response = self.client.get(reverse('logout'))
        self.assertEqual(response.status_code, 302)

        self.assertFalse('_auth_user_id' in self.client.session)
    
    def test_profile_access(self):
        user = User.objects.create_user(
            username='profileuser',
            password='testpass123'
        )
        self.client.login(username='profileuser', password='testpass123')

        response = self.client.get(reverse('profile'))
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, 'Мой профиль')
    
    def test_password_change(self):
        user = User.objects.create_user(
            username='changepass',
            password='oldpass123'
        )
        self.client.login(username='changepass', password='oldpass123')
        
        response = self.client.get(reverse('change_password'))
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, 'Смена пароля')


class AuthorizationAccessTests(TestCase):
    def test_authenticated_user_redirect_from_login(self):
        user = User.objects.create_user(
            username='loggedin',
            password='testpass123'
        )
        self.client.login(username='loggedin', password='testpass123')
        
        response = self.client.get(reverse('login'))
        self.assertEqual(response.status_code, 302)
        
    def test_unauthenticated_profile_access(self):
        response = self.client.get(reverse('profile'))
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, '/login/?next=/profile/')
    
    def test_user_model_creation(self):
        user = User.objects.create_user(
            username='modeluser',
            email='model@example.com',
            password='testpass123',
            phone='+375292222222',
            instrument='drums'
        )
        
        self.assertEqual(user.username, 'modeluser')
        self.assertEqual(user.email, 'model@example.com')
        self.assertEqual(user.phone, '+375292222222')
        self.assertEqual(user.instrument, 'drums')
        self.assertTrue(user.check_password('testpass123'))


class FormsTests(TestCase):
    def test_login_form_invalid(self):
        response = self.client.post(reverse('login'), {
            'username': '',
            'password': ''
        })
        self.assertEqual(response.status_code, 200)
        messages = list(get_messages(response.wsgi_request))
        self.assertTrue(len(messages) > 0)
    
    def test_registration_form_missing_data(self):
        response = self.client.post(reverse('register'), {
            'username': 'incomplete',
        })
        self.assertEqual(response.status_code, 200)
        self.assertFalse(User.objects.filter(username='incomplete').exists())
```

`for_authorization/urls.py`:

```py
from django.urls import path
from . import views
from .views import ProfileView, ProfileUpdateView, change_password

urlpatterns = [
    path('profile/', ProfileView.as_view(), name='profile'),
    path('profile/edit/', ProfileUpdateView.as_view(), name='profile_edit'),
    path('profile/change-password/', change_password, name='change_password'),
]
```

`for_authorization/views.py`:

```py
from django.shortcuts import render, redirect
from django.contrib.auth import login, logout, authenticate
from django.contrib.auth.decorators import login_required
from django.contrib.auth.forms import PasswordChangeForm, AuthenticationForm
from django.contrib import messages
from django.views.generic import CreateView, UpdateView, DetailView
from django.urls import reverse_lazy
from django.contrib.auth.mixins import LoginRequiredMixin

from .models import MusicianUser
from .forms import MusicianUserCreationForm, MusicianUserUpdateForm, MusicianAuthenticationForm

def home(request):
    return render(request, 'core/home.html')

def custom_login(request):
    if request.user.is_authenticated:
        return redirect('home')
        
    if request.method == 'POST':
        form = MusicianAuthenticationForm(request, data=request.POST)
        if form.is_valid():
            username = form.cleaned_data.get('username')
            password = form.cleaned_data.get('password')
            user = authenticate(request, username=username, password=password)
            
            if user is not None:
                login(request, user)
                messages.success(request, f'Добро пожаловать, {user.username}!')
                return redirect('home')
            else:
                messages.error(request, 'Неверное имя пользователя или пароль.')
        else:
            messages.error(request, 'Ошибка в форме входа.')
    else:
        form = MusicianAuthenticationForm()
    
    return render(request, 'core/registration/login.html', {'form': form})

@login_required
def custom_logout(request):
    logout(request)
    messages.info(request, 'Вы успешно вышли из системы.')
    return redirect('home')

class RegisterView(CreateView):
    form_class = MusicianUserCreationForm
    template_name = 'core/registration/register.html'
    success_url = reverse_lazy('home')
    
    def form_valid(self, form):
        response = super().form_valid(form)
        user = form.save()
        login(self.request, user)
        messages.success(self.request, f'Регистрация прошла успешно! Добро пожаловать, {user.username}!')
        return response
    
    def dispatch(self, request, *args, **kwargs):
        if request.user.is_authenticated:
            return redirect('home')
        return super().dispatch(request, *args, **kwargs)

class ProfileView(LoginRequiredMixin, DetailView):
    model = MusicianUser
    template_name = 'core/profile/profile.html'
    context_object_name = 'user_profile'
    
    def get_object(self):
        return self.request.user

class ProfileUpdateView(LoginRequiredMixin, UpdateView):
    model = MusicianUser
    form_class = MusicianUserUpdateForm
    template_name = 'core/profile/profile_edit.html'
    success_url = reverse_lazy('profile')
    
    def get_object(self):
        return self.request.user
    
    def form_valid(self, form):
        messages.success(self.request, 'Профиль успешно обновлен!')
        return super().form_valid(form)

@login_required
def change_password(request):
    if request.method == 'POST':
        form = PasswordChangeForm(request.user, request.POST)
        if form.is_valid():
            user = form.save()
            from django.contrib.auth import update_session_auth_hash
            update_session_auth_hash(request, user)
            messages.success(request, 'Пароль успешно изменен!')
            return redirect('profile')
        else:
            messages.error(request, 'Пожалуйста, исправьте ошибки ниже.')
    else:
        form = PasswordChangeForm(request.user)
    
    return render(request, 'core/profile/password_change.html', {'form': form})
```

`groups/admin.py`:

```py
from django.contrib import admin
```

`groups/apps.py`:

```py
from django.apps import AppConfig


class GroupsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'groups'
    verbose_name = 'Управление группами'
```

`groups/forms.py`:

```py
from django import forms
from django.core.exceptions import ValidationError
from django.utils import timezone
from core.models import Band, BandMembership, Musician


class BandForm(forms.ModelForm):
    class Meta:
        model = Band
        fields = ['band_name', 'genre', 'founded_date', 'logo']
        widgets = {
            'band_name': forms.TextInput(attrs={
                'class': 'form-control',
                'placeholder': 'Введите название группы'
            }),
            'genre': forms.Select(attrs={'class': 'form-control'}),
            'founded_date': forms.DateInput(attrs={
                'type': 'date',
                'class': 'form-control'
            }),
            'logo': forms.FileInput(attrs={
                'class': 'form-control',
                'accept': 'image/*'
            }),
        }
        labels = {
            'band_name': 'Название группы',
            'genre': 'Жанр',
            'founded_date': 'Дата основания',
            'logo': 'Логотип группы',
        }
    
    def clean_founded_date(self):
        founded_date = self.cleaned_data.get('founded_date')
        if founded_date and founded_date > timezone.now().date():
            raise ValidationError('Дата основания не может быть в будущем')
        return founded_date
    
    def clean_band_name(self):
        band_name = self.cleaned_data.get('band_name')
        if band_name and len(band_name.strip()) < 2:
            raise ValidationError('Название группы должно содержать минимум 2 символа')
        return band_name.strip()


class AddMemberForm(forms.ModelForm):
    musician = forms.ModelChoiceField(
        queryset=Musician.objects.all(),
        widget=forms.Select(attrs={'class': 'form-control'}),
        label='Музыкант'
    )
    join_date = forms.DateField(
        widget=forms.DateInput(attrs={'type': 'date', 'class': 'form-control'}),
        label='Дата вступления',
        initial=timezone.now().date()
    )
    
    class Meta:
        model = BandMembership
        fields = ['musician', 'join_date']
    
    def __init__(self, *args, **kwargs):
        self.band = kwargs.pop('band', None)
        super().__init__(*args, **kwargs)
        if self.band:
            existing_members = self.band.bandmembership_set.values_list('musician_id', flat=True)
            self.fields['musician'].queryset = Musician.objects.exclude(
                musician_id__in=existing_members
            )
    
    def clean(self):
        cleaned_data = super().clean()
        musician = cleaned_data.get('musician')
        join_date = cleaned_data.get('join_date')
        
        if musician and self.band:
            if BandMembership.objects.filter(band=self.band, musician=musician).exists():
                raise ValidationError('Этот музыкант уже состоит в группе')
        
        if join_date and join_date > timezone.now().date():
            raise ValidationError('Дата вступления не может быть в будущем')
        
        return cleaned_data
```

`groups/templates/groups/band_confirm_delete.html`:

```html
{% extends "base.html" %}

{% block title %}Удаление группы - Encore{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-danger text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-exclamation-triangle"></i> Подтверждение удаления
                    </h4>
                </div>
                <div class="card-body text-center">
                    <div class="mb-4">
                        <i class="bi bi-trash display-1 text-danger"></i>
                    </div>
                    
                    <h5 class="mb-3">Вы уверены, что хотите удалить группу?</h5>
                    
                    <div class="alert alert-warning">
                        <p><strong>{{ band.band_name }}</strong></p>
                        <p class="mb-0">
                            Жанр: <span class="badge bg-info">{{ band.genre }}</span><br>
                            Дата основания: {{ band.founded_date|date:"d.m.Y" }}<br>
                            Участников: {{ band.bandmembership_set.count }}
                        </p>
                    </div>
                    
                    <p class="text-muted">
                        <i class="bi bi-info-circle"></i>
                        Это действие нельзя отменить. Все данные о группе и её составе будут удалены.
                    </p>
                    
                    <form method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-lg">
                            <i class="bi bi-trash"></i> Удалить группу
                        </button>
                    </form>
                    <a href="{% url 'groups:band_list' %}" class="btn btn-outline-secondary btn-lg ms-2">
                        <i class="bi bi-x-circle"></i> Отмена
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`groups/templates/groups/band_confirm_remove.html`:

```html
{% extends "base.html" %}

{% block title %}Удаление участника - Encore{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-warning text-dark">
                    <h4 class="mb-0">
                        <i class="bi bi-person-x"></i> Удаление участника
                    </h4>
                </div>
                <div class="card-body text-center">
                    <div class="mb-4">
                        <i class="bi bi-exclamation-triangle display-1 text-warning"></i>
                    </div>
                    
                    <h5 class="mb-3">Вы уверены, что хотите удалить участника из группы?</h5>
                    
                    <div class="alert alert-light">
                        <p class="mb-2"><strong>Группа:</strong> {{ band.band_name }}</p>
                        <p class="mb-0"><strong>Музыкант:</strong> {{ membership.musician }}</p>
                        <p><strong>Инструмент:</strong> {{ membership.musician.get_instrument_display }}</p>
                        <p><strong>Дата вступления:</strong> {{ membership.join_date|date:"d.m.Y" }}</p>
                    </div>
                    
                    <p class="text-muted">
                        <i class="bi bi-info-circle"></i>
                        Музыкант будет удален только из состава этой группы. Его данные в системе останутся.
                    </p>
                    
                    <form method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-warning btn-lg">
                            <i class="bi bi-person-x"></i> Удалить из группы
                        </button>
                    </form>
                    <a href="{% url 'groups:band_members' band.pk %}" class="btn btn-outline-secondary btn-lg ms-2">
                        <i class="bi bi-x-circle"></i> Отмена
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`groups/templates/groups/band_form.html`:

```html
{% extends "base.html" %}

{% block title %}{{ title }} - Encore{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-pencil-square"></i> {{ title }}
                    </h4>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {% for error in form.non_field_errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                        
                        <div class="mb-3">
                            <label for="{{ form.band_name.id_for_label }}" class="form-label">
                                {{ form.band_name.label }}
                                {% if form.band_name.field.required %}<span class="text-danger">*</span>{% endif %}
                            </label>
                            {{ form.band_name }}
                            {% if form.band_name.errors %}
                                <div class="text-danger small mt-1">{{ form.band_name.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label for="{{ form.genre.id_for_label }}" class="form-label">
                                {{ form.genre.label }}
                                {% if form.genre.field.required %}<span class="text-danger">*</span>{% endif %}
                            </label>
                            {{ form.genre }}
                            {% if form.genre.errors %}
                                <div class="text-danger small mt-1">{{ form.genre.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            <label for="{{ form.founded_date.id_for_label }}" class="form-label">
                                {{ form.founded_date.label }}
                                {% if form.founded_date.field.required %}<span class="text-danger">*</span>{% endif %}
                            </label>
                            {{ form.founded_date }}
                            {% if form.founded_date.errors %}
                                <div class="text-danger small mt-1">{{ form.founded_date.errors.0 }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-4">
                            <label for="{{ form.logo.id_for_label }}" class="form-label">
                                {{ form.logo.label }}
                            </label>
                            {{ form.logo }}
                            {% if form.instance.logo %}
                                <div class="mt-2">
                                    <small class="text-muted">Текущий логотип:</small><br>
                                    <img src="{{ form.instance.logo.url }}" alt="Logo" class="img-thumbnail" style="max-height: 100px;">
                                </div>
                            {% endif %}
                            {% if form.logo.errors %}
                                <div class="text-danger small mt-1">{{ form.logo.errors.0 }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="d-flex justify-content-between mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-circle"></i> {{ submit_text }}
                            </button>
                            <a href="{% url 'groups:band_list' %}" class="btn btn-outline-secondary">
                                <i class="bi bi-x-circle"></i> Отмена
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`groups/templates/groups/band_list.html`:

```html
{% extends "base.html" %}

{% block title %}Управление группами - Encore{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-5 fw-bold text-primary">
                <i class="bi bi-people-fill"></i> Музыкальные группы
            </h1>
            <p class="lead">Управление музыкальными группами и их составом</p>
        </div>
        {% if user.is_staff %}
        <div class="col-auto">
            <a href="{% url 'groups:band_create' %}" class="btn btn-primary btn-lg">
                <i class="bi bi-plus-circle"></i> Новая группа
            </a>
        </div>
        {% endif %}
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="text" class="form-control" name="search" 
                               placeholder="Поиск по названию или жанру" 
                               value="{{ search_query }}">
                    </div>
                </div>
                <div class="col-md-4">
                    <select class="form-select" name="genre">
                        <option value="">Все жанры</option>
                        {% for genre in genres %}
                            <option value="{{ genre }}" {% if genre_filter == genre %}selected{% endif %}>
                                {{ genre }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-outline-primary w-100">
                        <i class="bi bi-filter"></i> Применить
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow">
        <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-list"></i> Список групп
                    {% if page_obj %}
                        <span class="badge bg-primary ms-2">{{ page_obj.paginator.count }}</span>
                    {% endif %}
                </h5>
                <div>
                    <a href="{% url 'groups:band_list' %}" class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-arrow-clockwise"></i> Сбросить
                    </a>
                </div>
            </div>
        </div>
        
        <div class="card-body">
            {% if page_obj %}
                <div class="table-responsive">
                    <table class="table table-hover table-striped align-middle">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 80px;">Лого</th>
                                <th>Название</th>
                                <th>Жанр</th>
                                <th>Дата основания</th>
                                <th>Участников</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for band in page_obj %}
                            <tr>
                                <td>
                                    {% if band.logo %}
                                        <img src="{{ band.logo.url }}" alt="{{ band.band_name }}" 
                                             class="rounded-circle" style="width: 50px; height: 50px; object-fit: cover;">
                                    {% else %}
                                        <div class="rounded-circle bg-secondary d-flex justify-content-center align-items-center text-white" 
                                             style="width: 50px; height: 50px;">
                                            <i class="bi bi-music-note"></i>
                                        </div>
                                    {% endif %}
                                </td>
                                <td>
                                    <strong>{{ band.band_name }}</strong>
                                </td>
                                <td>
                                    <span class="badge bg-info">{{ band.genre }}</span>
                                </td>
                                <td>{{ band.founded_date|date:"d.m.Y" }}</td>
                                <td>
                                    <span class="badge bg-primary">{{ band.bandmembership_set.count }}</span>
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a href="{% url 'groups:band_members' band.pk %}" 
                                           class="btn btn-outline-primary" title="Состав">
                                            <i class="bi bi-people"></i>
                                        </a>
                                        
                                        {% if user.is_staff %}
                                        <a href="{% url 'groups:band_update' band.pk %}" 
                                           class="btn btn-outline-secondary" title="Редактировать">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <a href="{% url 'groups:band_delete' band.pk %}" 
                                           class="btn btn-outline-danger" title="Удалить">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% if page_obj.has_other_pages %}
                <nav aria-label="Навигация">
                    <ul class="pagination justify-content-center mt-4">
                        {% if page_obj.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if genre_filter %}&genre={{ genre_filter }}{% endif %}">
                                    <i class="bi bi-chevron-left"></i>
                                </a>
                            </li>
                        {% endif %}

                        <li class="page-item active"><span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>

                        {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if genre_filter %}&genre={{ genre_filter }}{% endif %}">
                                    <i class="bi bi-chevron-right"></i>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
            {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-people display-1 text-muted"></i>
                    <h4 class="text-muted mt-3">Группы не найдены</h4>
                    {% if user.is_staff %}
                    <a href="{% url 'groups:band_create' %}" class="btn btn-primary mt-2">
                        <i class="bi bi-plus-circle"></i> Создать первую группу
                    </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card text-bg-primary h-100">
                <div class="card-body text-center">
                    <h6 class="card-title">Всего групп</h6>
                    <p class="display-6 mb-0">{{ total_bands }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-bg-success h-100">
                <div class="card-body text-center">
                    <h6 class="card-title">Жанров</h6>
                    <p class="display-6 mb-0">{{ total_genres }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-bg-info h-100">
                <div class="card-body text-center">
                    <h6 class="card-title">Музыкантов</h6>
                    <p class="display-6 mb-0">{{ total_musicians }}</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`groups/templates/groups/band_members.html`:

```html
{% extends "base.html" %}

{% block title %}Состав группы - Encore{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'groups:band_list' %}">Группы</a></li>
                    <li class="breadcrumb-item active">{{ band.band_name }}</li>
                </ol>
            </nav>
            
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-shrink-0 me-4">
                            {% if band.logo %}
                                <img src="{{ band.logo.url }}" alt="{{ band.band_name }}" 
                                     class="rounded img-thumbnail" style="width: 120px; height: 120px; object-fit: cover;">
                            {% else %}
                                <div class="rounded bg-light d-flex justify-content-center align-items-center text-secondary border" 
                                     style="width: 120px; height: 120px;">
                                    <i class="bi bi-music-note-beamed display-4"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="flex-grow-1">
                            <h1 class="display-6 fw-bold mb-2">{{ band.band_name }}</h1>
                            <p class="mb-2">
                                <span class="badge bg-info text-dark">{{ band.genre }}</span>
                                <span class="text-muted ms-2"><i class="bi bi-calendar"></i> Основана: {{ band.founded_date|date:"d.m.Y" }}</span>
                            </p>
                            <div>
                                {% if is_manager %}
                                <a href="{% url 'groups:band_update' band.pk %}" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-pencil"></i> Редактировать
                                </a>
                                {% endif %}
                                <a href="{% url 'groups:band_list' %}" class="btn btn-sm btn-outline-secondary ms-1">
                                    <i class="bi bi-arrow-left"></i> Назад к списку
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if is_manager %}
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-person-plus"></i> Добавить участника</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="add_member" value="1">
                        
                        <div class="mb-3">
                            <label class="form-label">Музыкант *</label>
                            {{ add_form.musician }}
                            {% if add_form.musician.errors %}
                                <div class="text-danger">{{ add_form.musician.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Дата вступления *</label>
                            {{ add_form.join_date }}
                            {% if add_form.join_date.errors %}
                                <div class="text-danger">{{ add_form.join_date.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-check-circle"></i> Добавить
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-info-circle"></i> Статистика</h5>
                </div>
                <div class="card-body d-flex align-items-center justify-content-around">
                    <div class="text-center">
                        <i class="bi bi-people display-4 text-primary"></i>
                        <h3 class="mt-2">{{ memberships.count }}</h3>
                        <p class="text-muted">Участников</p>
                    </div>
                    <div class="text-center">
                        <i class="bi bi-calendar-event display-4 text-warning"></i>
                        <h3 class="mt-2">{{ band.founded_date|timesince }}</h3>
                        <p class="text-muted">Существует</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="card shadow">
        <div class="card-header bg-light">
            <h5 class="mb-0">
                <i class="bi bi-person-lines-fill"></i> Текущий состав
            </h5>
        </div>
        
        <div class="card-body">
            {% if memberships %}
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Имя</th>
                                <th>Инструмент</th>
                                <th>Контакты</th>
                                <th>Дата вступления</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for membership in memberships %}
                            <tr>
                                <td>
                                    <strong>{{ membership.musician.first_name }} {{ membership.musician.last_name }}</strong>
                                </td>
                                <td>
                                    <span class="badge bg-secondary">
                                        {{ membership.musician.get_instrument_display }}
                                    </span>
                                </td>
                                <td>
                                    <div class="small">
                                        <i class="bi bi-telephone"></i> {{ membership.musician.phone }}<br>
                                        {% if membership.musician.telegram %}
                                            <i class="bi bi-telegram text-info"></i> {{ membership.musician.telegram }}
                                        {% endif %}
                                    </div>
                                </td>
                                <td>{{ membership.join_date|date:"d.m.Y" }}</td>
                                <td>
                                    {% if is_manager %}
                                    <form method="post" action="{% url 'groups:member_remove' band.pk membership.id %}" 
                                          class="d-inline"
                                          onsubmit="return confirm('Удалить этого музыканта из группы?');">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-sm btn-outline-danger" title="Исключить">
                                            <i class="bi bi-person-x"></i>
                                        </button>
                                    </form>
                                    {% else %}
                                    <span class="text-muted small">—</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-person-x display-1 text-muted"></i>
                    <h4 class="text-muted mt-3">В группе пока нет участников</h4>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
```

`groups/templates/groups/member_confirm_remove.html`:

```html
{% extends "base.html" %}

{% block title %}Удаление участника - Encore{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-warning text-dark">
                    <h4 class="mb-0">
                        <i class="bi bi-person-x"></i> Удаление участника
                    </h4>
                </div>
                <div class="card-body text-center">
                    <div class="mb-4">
                        <i class="bi bi-exclamation-triangle display-1 text-warning"></i>
                    </div>
                    
                    <h5 class="mb-3">Вы уверены, что хотите удалить участника из группы?</h5>
                    
                    <div class="alert alert-light">
                        <p class="mb-2"><strong>Группа:</strong> {{ band.band_name }}</p>
                        <p class="mb-0"><strong>Музыкант:</strong> {{ membership.musician }}</p>
                        <p><strong>Инструмент:</strong> {{ membership.musician.get_instrument_display }}</p>
                        <p><strong>Дата вступления:</strong> {{ membership.join_date|date:"d.m.Y" }}</p>
                    </div>
                    
                    <p class="text-muted">
                        <i class="bi bi-info-circle"></i>
                        Музыкант будет удален только из состава этой группы. Его данные в системе останутся.
                    </p>
                    
                    <form method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-warning btn-lg">
                            <i class="bi bi-person-x"></i> Удалить из группы
                        </button>
                    </form>
                    <a href="{% url 'groups:band_members' band.pk %}" class="btn btn-outline-secondary btn-lg ms-2">
                        <i class="bi bi-x-circle"></i> Отмена
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
```

`groups/tests.py`:

```py
import tempfile
import shutil
from django.test import TestCase, Client, override_settings
from django.urls import reverse
from django.contrib.auth import get_user_model
from django.core.files.uploadedfile import SimpleUploadedFile
from core.models import Band, Musician, BandMembership

User = get_user_model()

TEMP_MEDIA_ROOT = tempfile.mkdtemp(prefix='encore_tests_media_')

@override_settings(MEDIA_ROOT=TEMP_MEDIA_ROOT)
class GroupsAccessTests(TestCase):
    def setUp(self):
        self.client = Client()
        
        self.manager_user = User.objects.create_user(
            username='manager', password='password', is_staff=True, phone='+375000000000'
        )
        
        self.musician_user = User.objects.create_user(
            username='musician', password='password', is_staff=False, phone='+375291111111'
        )
        self.core_musician = Musician.objects.create(
            first_name='John', last_name='Doe', phone='+375291111111', instrument='guitar'
        )
        
        self.guest_user = User.objects.create_user(
            username='guest', password='password', is_staff=False, phone='+375292222222'
        )

        self.band_rock = Band.objects.create(band_name="Rock Band", genre="rock")
        self.band_pop = Band.objects.create(band_name="Pop Band", genre="pop")
        
        BandMembership.objects.create(band=self.band_rock, musician=self.core_musician)

    def tearDown(self):
        shutil.rmtree(TEMP_MEDIA_ROOT, ignore_errors=True)

    def test_guest_access_denied(self):
        self.client.login(username='guest', password='password')
        response = self.client.get(reverse('groups:band_list'))
        self.assertEqual(response.status_code, 302)
        self.assertRedirects(response, reverse('home'))

    def test_musician_sees_only_own_bands(self):
        self.client.login(username='musician', password='password')
        response = self.client.get(reverse('groups:band_list'))
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, "Rock Band")
        self.assertNotContains(response, "Pop Band")

    def test_manager_sees_all_bands(self):
        self.client.login(username='manager', password='password')
        response = self.client.get(reverse('groups:band_list'))
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, "Rock Band")
        self.assertContains(response, "Pop Band")

    def test_manager_create_band_with_logo(self):
        self.client.login(username='manager', password='password')
        
        small_gif = (
            b'\x47\x49\x46\x38\x39\x61\x01\x00\x01\x00\x00\x00\x00\x21\xf9\x04'
            b'\x01\x0a\x00\x01\x00\x2c\x00\x00\x00\x00\x01\x00\x01\x00\x00\x02'
            b'\x02\x4c\x01\x00\x3b'
        )
        logo = SimpleUploadedFile('test_logo.gif', small_gif, content_type='image/gif')
        
        data = {
            'band_name': 'New Metal Band',
            'genre': 'metal',
            'founded_date': '2023-01-01',
            'logo': logo
        }
        
        response = self.client.post(reverse('groups:band_create'), data, follow=True)
        self.assertEqual(response.status_code, 200)
        
        new_band = Band.objects.get(band_name='New Metal Band')
        self.assertTrue(bool(new_band.logo))
        self.assertTrue('test_logo' in new_band.logo.name)

    def test_crud_access(self):
        self.client.login(username='musician', password='password')
        response = self.client.get(reverse('groups:band_create'))
        self.assertEqual(response.status_code, 403)
        
        self.client.login(username='manager', password='password')
        delete_url = reverse('groups:band_delete', args=[self.band_pop.pk])
        response = self.client.post(delete_url)
        self.assertEqual(response.status_code, 302)
        self.assertFalse(Band.objects.filter(pk=self.band_pop.pk).exists())
```

`groups/urls.py`:

```py
from django.urls import path
from . import views

app_name = 'groups'

urlpatterns = [
    path('', views.BandListView.as_view(), name='band_list'),
    path('create/', views.BandCreateView.as_view(), name='band_create'),
    path('<int:pk>/edit/', views.BandUpdateView.as_view(), name='band_update'),
    path('<int:pk>/delete/', views.BandDeleteView.as_view(), name='band_delete'),
    
    path('<int:pk>/members/', views.band_members, name='band_members'),
    path('<int:pk>/members/<int:member_id>/remove/', views.member_remove, name='member_remove'),
]
```

`groups/views.py`:

```py
from django.shortcuts import render, redirect, get_object_or_404
from django.contrib.auth.decorators import login_required, user_passes_test
from django.contrib.auth.mixins import LoginRequiredMixin, UserPassesTestMixin
from django.contrib import messages
from django.db.models import Q
from django.urls import reverse_lazy
from django.views.generic import ListView, CreateView, UpdateView, DeleteView

from core.models import Band, BandMembership, Musician
from .forms import BandForm, AddMemberForm

def get_current_musician(user):
    if not user.is_authenticated or not user.phone:
        return None
    try:
        return Musician.objects.get(phone=user.phone)
    except Musician.DoesNotExist:
        return None

def is_manager(user):
    return user.is_authenticated and user.is_staff

class BandListView(LoginRequiredMixin, ListView):
    model = Band
    template_name = 'groups/band_list.html'
    context_object_name = 'bands'
    paginate_by = 10

    def dispatch(self, request, *args, **kwargs):
        if not request.user.is_authenticated:
            return self.handle_no_permission()
        
        if not request.user.is_staff and get_current_musician(request.user) is None:
            messages.error(request, "У вас нет прав для просмотра списка групп. Требуется профиль музыканта.")
            return redirect('home')
            
        return super().dispatch(request, *args, **kwargs)

    def get_queryset(self):
        queryset = super().get_queryset().order_by('band_name')
        user = self.request.user
        
        if not user.is_staff:
            musician = get_current_musician(user)
            if musician:
                queryset = queryset.filter(bandmembership__musician=musician)
            else:
                queryset = queryset.none()

        search_query = self.request.GET.get('search', '')
        if search_query:
            queryset = queryset.filter(
                Q(band_name__icontains=search_query) |
                Q(genre__icontains=search_query)
            )
        
        genre_filter = self.request.GET.get('genre', '')
        if genre_filter:
            queryset = queryset.filter(genre=genre_filter)
            
        return queryset.distinct()

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        
        context['search_query'] = self.request.GET.get('search', '')
        context['genre_filter'] = self.request.GET.get('genre', '')
        context['genres'] = Band.objects.values_list('genre', flat=True).distinct().order_by('genre')
        
        context['total_bands'] = Band.objects.count()
        context['total_genres'] = Band.objects.values('genre').distinct().count()
        context['total_musicians'] = Musician.objects.count()

        return context


class BandCreateView(LoginRequiredMixin, UserPassesTestMixin, CreateView):
    model = Band
    form_class = BandForm
    template_name = 'groups/band_form.html'
    success_url = reverse_lazy('groups:band_list')

    def test_func(self):
        return is_manager(self.request.user)

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['title'] = 'Создание новой группы'
        context['submit_text'] = 'Создать группу'
        return context

    def form_valid(self, form):
        messages.success(self.request, f'Группа "{form.instance.band_name}" успешно создана!')
        return super().form_valid(form)


class BandUpdateView(LoginRequiredMixin, UserPassesTestMixin, UpdateView):
    model = Band
    form_class = BandForm
    template_name = 'groups/band_form.html'
    success_url = reverse_lazy('groups:band_list')

    def test_func(self):
        return is_manager(self.request.user)

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['title'] = f'Редактирование группы: {self.object.band_name}'
        context['submit_text'] = 'Сохранить изменения'
        return context

    def form_valid(self, form):
        messages.success(self.request, f'Группа "{form.instance.band_name}" успешно обновлена!')
        return super().form_valid(form)


class BandDeleteView(LoginRequiredMixin, UserPassesTestMixin, DeleteView):
    model = Band
    template_name = 'groups/band_confirm_delete.html'
    success_url = reverse_lazy('groups:band_list')

    def test_func(self):
        return is_manager(self.request.user)

    def form_valid(self, form):
        messages.success(self.request, f'Группа "{self.object.band_name}" успешно удалена!')
        return super().form_valid(form)

@login_required
def band_members(request, pk):
    band = get_object_or_404(Band, pk=pk)
    user = request.user
    
    if not user.is_staff:
        musician = get_current_musician(user)
        if not musician:
            messages.error(request, "Доступ запрещен.")
            return redirect('home')
        
        if not BandMembership.objects.filter(band=band, musician=musician).exists():
            messages.error(request, "Вы не являетесь участником этой группы.")
            return redirect('groups:band_list')

    add_form = None
    if user.is_staff:
        add_form = AddMemberForm(band=band)
        if request.method == 'POST' and 'add_member' in request.POST:
            add_form = AddMemberForm(request.POST, band=band)
            if add_form.is_valid():
                membership = add_form.save(commit=False)
                membership.band = band
                membership.save()
                messages.success(request, f'Музыкант добавлен в группу!')
                return redirect('groups:band_members', pk=band.pk)

    memberships = BandMembership.objects.filter(band=band).select_related('musician').order_by('-join_date')
    
    context = {
        'band': band,
        'memberships': memberships,
        'add_form': add_form,
        'is_manager': user.is_staff
    }
    
    return render(request, 'groups/band_members.html', context)


@login_required
@user_passes_test(is_manager)
def member_remove(request, pk, member_id):
    band = get_object_or_404(Band, pk=pk)
    membership = get_object_or_404(BandMembership, id=member_id, band=band)
    
    if request.method == 'POST':
        musician_name = str(membership.musician)
        membership.delete()
        messages.success(request, f'Музыкант {musician_name} удален из группы!')
        return redirect('groups:band_members', pk=band.pk)
    
    return render(request, 'groups/member_confirm_remove.html', {
        'band': band,
        'membership': membership
    })
```

`manage.py`:

```py
"""Django's command-line utility for administrative tasks."""
import os
import sys

def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)

if __name__ == '__main__':
    main()

```

`requirements.txt`:

```txt
asgiref==3.11.0
Django==5.2.9
pillow==12.0.0
psycopg2-binary==2.9.11
sqlparse==0.5.4

```

`templates/base.html`:

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Encore - Музыкальная система{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }
        .main-container {
            min-height: calc(100vh - 120px);
        }
        .concert-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            overflow: hidden;
        }
        .concert-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .concert-date {
            color: #6c757d;
            font-size: 0.9rem;
        }
        .concert-venue {
            color: #495057;
        }
        .band-tag {
            display: inline-block;
            background-color: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 2px;
            font-size: 0.8rem;
        }
        .footer {
            background-color: #343a40;
            color: white;
            padding: 20px 0;
            margin-top: 40px;
        }
        .table th {
            background-color: #f8f9fa;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="bi bi-music-note-beamed"></i> Encore
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <!-- Существующие пункты меню -->
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'book' %}">
                            <i class="bi bi-calendar-plus"></i> Бронирование репетиций
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'concertsshower:upcoming_concerts' %}">
                            <i class="bi bi-calendar-event"></i> Ближайшие концерты
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'concertsshower:all_concerts' %}">
                            <i class="bi bi-calendar3"></i> Все концерты
                        </a>
                    </li>
                    
                    <!-- НОВЫЙ ПУНКТ: Группы -->
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'groups:band_list' %}">
                            <i class="bi bi-people-fill"></i> Музыкальные группы
                        </a>
                    </li>
                    
                    {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'profile' %}">
                            <i class="bi bi-person-circle"></i> Профиль
                        </a>
                    </li>
                    {% endif %}
                </ul>
                
                <!-- Правая часть навигации (авторизация) -->
                <ul class="navbar-nav">
                    {% if user.is_authenticated %}
                    <li class="nav-item">
                        <span class="nav-link text-light">
                            <i class="bi bi-person"></i> {{ user.username }}
                        </span>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-warning" href="{% url 'logout' %}">
                            <i class="bi bi-box-arrow-right"></i> Выйти
                        </a>
                    </li>
                    {% else %}
                    <li class="nav-item">
                        <a class="nav-link text-light" href="{% url 'login' %}">
                            <i class="bi bi-box-arrow-in-right"></i> Войти
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-light" href="{% url 'register' %}">
                            <i class="bi bi-person-plus"></i> Регистрация
                        </a>
                    </li>
                    {% endif %}
                    
                    {% if user.is_staff %}
                    <li class="nav-item">
                        <a class="nav-link text-light" href="/admin-panel/">
                            <i class="bi bi-gear"></i> Администрирование
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- Основной контент -->
    <div class="main-container">
        <div class="container py-4">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        <i class="bi 
                            {% if message.tags == 'success' %}bi-check-circle-fill
                            {% elif message.tags == 'error' or message.tags == 'danger' %}bi-exclamation-triangle-fill
                            {% elif message.tags == 'warning' %}bi-exclamation-circle-fill
                            {% else %}bi-info-circle-fill{% endif %}
                        "></i>
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            {% block content %}{% endblock %}
        </div>
    </div>

    <!-- Футер -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="bi bi-music-note-beamed"></i> Encore</h5>
                    <p class="mb-0">Система управления концертами и репетициями</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">© {% now "Y" %} Encore. Все права защищены.</p>
                    <p class="mb-0 small">Версия 1.0.0</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
```